# ML Portal Refactoring Tasks

## üéØ –¶–µ–ª—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
–ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è API –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã: –æ–¥–∏–Ω –≤—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª, –µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤, —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤.

## üìã –ß–µ–∫–ª–∏—Å—Ç –∑–∞–¥–∞—á

### ‚úÖ –≠—Ç–∞–ø 1: –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω–æ–π —Ç–æ—á–∫–∏
- [x] **1.1** Merge main_enhanced ‚Üí main
- [x] **1.2** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —Ä–æ—É—Ç–µ—Ä—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑ routers/*
- [x] **1.3** –¢–µ—Å—Ç—ã: pytest -k health –∑–µ–ª–µ–Ω—ã–π
- [x] **1.4** E2E: –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏ –æ—Ç–≤–µ—á–∞–µ—Ç /health

### ‚úÖ –≠—Ç–∞–ø 2: –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è HTTP —Å–ª–æ—è
- [ ] **2.1** Move controllers/chats ‚Üí routers/chats
- [ ] **2.2** Move controllers/rag ‚Üí routers/rag
- [ ] **2.3** Move controllers/users ‚Üí routers/users
- [ ] **2.4** –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã —Ä–æ—É—Ç–µ—Ä–æ–≤
- [ ] **2.5** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ª–æ–≥–∏–∫–∞ —Ç–æ–ª—å–∫–æ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤ —Å–µ—Ä–≤–∏—Å—ã

### ‚úÖ –≠—Ç–∞–ø 3: –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π
- [ ] **3.1** Extract ChatService (+tests)
- [ ] **3.2** Extract RagIngestService (+tests)
- [ ] **3.3** Extract RagSearchService (+tests)
- [ ] **3.4** Extract AnalyzeService (+tests)
- [ ] **3.5** Extract AuthService (+tests)
- [ ] **3.6** Create ModelCatalog (+tests)

### ‚úÖ –≠—Ç–∞–ø 4: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è ingestion
- [ ] **4.1** Unify rag_search into rag
- [ ] **4.2** –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä —Ä–∞–∑–±–æ—Ä–∫–∏/–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- [ ] **4.3** AnalyzeService –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç RAG pipeline
- [ ] **4.4** Unit —Ç–µ—Å—Ç—ã —Å –º–æ–∫–∞–º–∏
- [ ] **4.5** Integration —Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ compose.test

### ‚úÖ –≠—Ç–∞–ø 5: –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã LLM/Embeddings
- [ ] **5.1** Add LLMClient facade (+tests)
- [ ] **5.2** Add EmbClient facade (+tests)
- [ ] **5.3** –õ–æ–∫–∞–ª—å–Ω—ã–µ HF –º–æ–¥–µ–ª–∏ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- [ ] **5.4** –ö–æ–Ω—Ñ–∏–≥–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –≤–µ—Å–æ–≤
- [ ] **5.5** –¢–µ—Å—Ç—ã —Å tiny-–º–æ–¥–µ–ª—è–º–∏

### ‚úÖ –≠—Ç–∞–ø 6: –ß–∏—Å—Ç–∫–∞ –¥—É–±–ª–µ–π
- [ ] **6.1** Delete main_enhanced.py
- [ ] **6.2** Delete controllers/* (–ø–æ—Å–ª–µ –ø–µ—Ä–µ–Ω–æ—Å–∞)
- [ ] **6.3** Delete rag_search.py (–ø–æ—Å–ª–µ –º–µ—Ä–∂–∞)
- [ ] **6.4** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å setup.py –∏ password_reset.py
- [ ] **6.5** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –∑–µ–ª–µ–Ω—ã–µ

### ‚úÖ –≠—Ç–∞–ø 7: RBAC + –∞–¥–º–∏–Ω
- [ ] **7.1** Seed superuser (+tests)
- [ ] **7.2** RBAC –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (+tests)
- [ ] **7.3** –°–∫—Ä–∏–ø—Ç create_superuser.py
- [ ] **7.4** Makefile —Ü–µ–ª—å seed-admin
- [ ] **7.5** Integration —Ç–µ—Å—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### ‚úÖ –≠—Ç–∞–ø 8: –¢–µ—Å—Ç–æ–≤–∞—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞
- [ ] **8.1** –û–±–Ω–æ–≤–∏—Ç—å pytest.ini —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏
- [ ] **8.2** –î–æ–±–∞–≤–∏—Ç—å make test (–±—ã—Å—Ç—Ä—ã–π)
- [ ] **8.3** –î–æ–±–∞–≤–∏—Ç—å make test-all (–ø–æ–ª–Ω—ã–π)
- [ ] **8.4** –î–æ–±–∞–≤–∏—Ç—å make seed-admin
- [ ] **8.5** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ CI —Ä–∞–±–æ—Ç–∞–µ—Ç

### ‚úÖ –≠—Ç–∞–ø 9: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] **9.1** –û–±–Ω–æ–≤–∏—Ç—å README —Å –Ω–æ–≤—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏
- [ ] **9.2** –û–±–Ω–æ–≤–∏—Ç—å Makefile targets
- [ ] **9.3** –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
- [ ] **9.4** –û–±–Ω–æ–≤–∏—Ç—å API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
docker compose -f docker-compose.test.yml up -d --build
docker compose -f docker-compose.test.yml exec api make test
```

### –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ç–∫–∏ –¥–ª—è –∑–∞–¥–∞—á–∏
```bash
git checkout -b refactor/routers-consolidation-01
```

### –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
```bash
make git-auto
```

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å
- **–ó–∞–≤–µ—Ä—à–µ–Ω–æ**: 0/45 –∑–∞–¥–∞—á (0%)
- **–¢–µ–∫—É—â–∞—è –≤–µ—Ç–∫–∞**: main
- **–°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞**: Merge main_enhanced ‚Üí main

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –∑–µ–ª–µ–Ω—ã–µ
- [ ] E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] CI/CD —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ö–æ–¥ —Ä–µ–≤—å—é –ø—Ä–æ–π–¥–µ–Ω
