# ML-Portal — Backlog задач (по блокам, высокого уровня)

Формат для каждого блока: **Рефакторинг → Определение недостающего → Реализация → Проверка тестами**. Без кода и конкретных команд.

## EPIC 1. Ручки (HTTP/API)
- **Рефакторинг**
  - Устранить дубли точек входа, оставить один entrypoint.
  - Привести к routers‑only; стандартизировать формат ошибок.
- **Недостающее**
  - Классический чат (sync/stream), RAG‑чат (sync/stream).
  - Ingest источников/доков, анализ документа.
  - Админ/RBAC/тенанты, каталог моделей.
- **Реализация**
  - Добавить отсутствующие хэндлеры, согласовать вход/выход.
  - Разнести public/internal/admin.
- **Проверка тестами**
  - Удалить легаси‑ендпоинты.
  - Выявить/дописать непокрытые тестами хэндлеры.
  - Прогнать контейнерные профили (быстрый/полный).

## EPIC 2. Коннекторы (LLM/Embeddings/Storage/Index)
- **Рефакторинг**
  - Ввести унифицированные интерфейсы клиентов и бэкендов.
- **Недостающее**
  - Мульти‑модель и версии; приоритет stream/non‑stream; ретраи.
- **Реализация**
  - LLM: generate / generate_stream; Embeddings: embed(batch).
  - ArtifactStore/VectorIndex с офлайн‑режимом.
- **Проверка тестами**
  - Моки транспорта; интеграция с tiny‑моделями; нагрузочный профиль.

## EPIC 3. Модели (доменные/ML)
- **Рефакторинг**
  - Отделить доменные DTO от ML‑схем; убрать дубли.
- **Недостающее**
  - User/Tenant/Project/Roles; Provider/Model/Version; Job/Task/Document/Source/Artifact.
- **Реализация**
  - Типы/валидаторы/статусы; идемпотентные ключи.
- **Проверка тестами**
  - Unit валидаторов/преобразований; миграции/фикстуры.

## EPIC 4. Схемы (контракты/валидация)
- **Рефакторинг**
  - Единый формат ошибок; базовые схемы основных сценариев.
- **Недостающее**
  - Схемы ingest/analyze/chat‑stream; auth/RBAC/тенанты.
- **Реализация**
  - Валидация входов/выходов; генерация клиента для FE.
- **Проверка тестами**
  - Контрактные тесты (ответы ↔ схема); негативные кейсы.

## EPIC 5. Логика (сервисы/пайплайны)
- **Рефакторинг**
  - Тонкие роутеры, логика в сервисах; единый ingestion‑pipeline.
- **Недостающее**
  - ChatService, RagIngestService, RagSearchService, AnalyzeService, AuthService.
- **Реализация**
  - Контракты методов; связывание с коннекторами/хранилищами.
- **Проверка тестами**
  - Unit сервисов; интеграции (индекс/база/модели); e2e: ingest → RAG‑чат → анализ.

## EPIC 6. Админка/RBAC/онбординг
- **Рефакторинг**
  - Разнести public/internal/admin ручки.
- **Недостающее**
  - Seed суперпользователя; роли; PAT‑токены.
- **Реализация**
  - Скрипт/команда seed; проверки прав; базовые экраны админки (если есть UI).
- **Проверка тестами**
  - unit/int auth; e2e онбординг.

## EPIC 7. Наблюдаемость
- **Рефакторинг**
  - Health/metrics/logs, корреляция по job_id.
- **Недостающее**
  - Алёрты; метрики ключевых сценариев; приоритеты stream/non‑stream.
- **Реализация**
  - Экспортеры; корелляция запросов и джоб.
- **Проверка тестами**
  - Смоук‑метрики в тестовом стенде.

## EPIC 8. Данные/Артефакты
- **Рефакторинг**
  - Каталог артефактов и TTL/ретеншн.
- **Недостающее**
  - Версионирование моделей/датасетов; S3‑совместимые бэкенды.
- **Реализация**
  - ArtifactStore; инвентарь индексов; миграции.
- **Проверка тестами**
  - Интеграционные операции с файлами/блобами; очистка/ретеншн.

## EPIC 9. Фронтенд
- **Рефакторинг**
  - Типобезопасный API‑клиент; убрать дубли компонентов.
- **Недостающее**
  - Страницы Chat/RAG Chat/Documents/Sources/Settings; SSE.
- **Реализация**
  - Подключение к API‑клиенту; состояния загрузки/ошибок.
- **Проверка тестами**
  - Unit компонентов; e2e пользовательские сценарии.

## EPIC 10. CI/CD
- **Рефакторинг**
  - Матрица быстрых/полных прогонов; кэш зависимостей/моделей.
- **Недостающее**
  - GPU/self‑host профиль при необходимости; nightly/regression.
- **Реализация**
  - Workflows: lint/type/unit → int → e2e; артефакты/отчёты.
- **Проверка тестами**
  - Смоук на PR; полный прогон по релизным веткам.
