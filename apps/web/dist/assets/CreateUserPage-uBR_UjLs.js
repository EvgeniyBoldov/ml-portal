import{u as $,d as q,r as m,j as e}from"./index-FkM6qUsl.js";import{a as N}from"./admin-DK_EKAlb.js";import{B as S}from"./Button-t5z5qQ-u.js";import{I as h}from"./Input-THmdJdCV.js";import{S as C}from"./Select-CqlyniY_.js";import"./idempotency-C3fxGORY.js";const G="_page_1de2g_1",H="_pageHeader_1de2g_6",A="_pageTitle_1de2g_10",F="_pageDescription_1de2g_17",R="_form_1de2g_23",D="_formSection_1de2g_30",U="_sectionTitle_1de2g_38",O="_formGrid_1de2g_47",B="_formGroup_1de2g_53",z="_formLabel_1de2g_63",Z="_required_1de2g_69",V="_formInput_1de2g_74",J="_formSelect_1de2g_78",K="_formCheckbox_1de2g_88",M="_formCheckboxInput_1de2g_95",Q="_formCheckboxLabel_1de2g_101",W="_formHelp_1de2g_107",X="_formError_1de2g_113",Y="_passwordToggle_1de2g_119",ee="_passwordToggleLabel_1de2g_130",se="_passwordToggleSwitch_1de2g_137",ae="_active_1de2g_147",re="_passwordField_1de2g_167",oe="_formActions_1de2g_171",ie="_passwordPolicy_1de2g_180",le="_passwordPolicyTitle_1de2g_188",te="_passwordPolicyList_1de2g_195",ne="_passwordPolicyItem_1de2g_204",ce="_valid_1de2g_212",de="_invalid_1de2g_216",me="_passwordPolicyIcon_1de2g_220",s={page:G,pageHeader:H,pageTitle:A,pageDescription:F,form:R,formSection:D,sectionTitle:U,formGrid:O,formGroup:B,formLabel:z,required:Z,formInput:V,formSelect:J,formCheckbox:K,formCheckboxInput:M,formCheckboxLabel:Q,formHelp:W,formError:X,passwordToggle:Y,passwordToggleLabel:ee,passwordToggleSwitch:se,active:ae,passwordField:re,formActions:oe,passwordPolicy:ie,passwordPolicyTitle:le,passwordPolicyList:te,passwordPolicyItem:ne,valid:ce,invalid:de,passwordPolicyIcon:me};function we(){const u=$(),P=q(),[r,p]=m.useState({login:"",email:"",role:"reader",is_active:!0,password:"",send_email:!0,require_password_change:!0}),[i,c]=m.useState({}),[g,f]=m.useState(!1),[T,I]=m.useState(!1);m.useEffect(()=>{(async()=>{try{const o=await N.getSystemStatus();I(o.email_enabled),o.email_enabled||p(l=>({...l,send_email:!1}))}catch(o){console.error("Failed to load system status:",o)}})()},[]);const w=a=>[{test:a.length>=8,message:"At least 8 characters"},{test:/[A-Z]/.test(a),message:"One uppercase letter"},{test:/[a-z]/.test(a),message:"One lowercase letter"},{test:/\d/.test(a),message:"One number"},{test:/[!@#$%^&*(),.?":{}|<>]/.test(a),message:"One special character"}].map(l=>({...l,valid:l.test})),L=()=>{const a={};return r.login.trim()?r.login.length<3?a.login="Login must be at least 3 characters":/^[a-zA-Z0-9_-]+$/.test(r.login)||(a.login="Login can only contain letters, numbers, hyphens, and underscores"):a.login="Login is required",r.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email)&&(a.email="Please enter a valid email address"),r.send_email||(r.password?w(r.password).filter(t=>!t.valid).length>0&&(a.password="Password does not meet requirements"):a.password="Password is required when not sending email"),c(a),Object.keys(a).length===0},k=async a=>{var o,l,t,v,x,j,b,y;if(a.preventDefault(),!!L()){f(!0),c({});try{const n={login:r.login.trim(),email:r.email.trim()||void 0,role:r.role,is_active:r.is_active,send_email:r.send_email};r.send_email||(n.password=r.password);const _=await N.createUser(n);P(`User ${r.login} created successfully${_.password?` with password: ${_.password}`:""}`),u(`/admin/users/${_.user.id}`)}catch(n){console.error("Failed to create user:",n),((v=(t=(l=(o=n.response)==null?void 0:o.data)==null?void 0:l.detail)==null?void 0:t.error)==null?void 0:v.code)==="user_exists"?c({login:"User with this login already exists"}):((y=(b=(j=(x=n.response)==null?void 0:x.data)==null?void 0:j.detail)==null?void 0:b.error)==null?void 0:y.code)==="invalid_password"?c({password:n.response.data.detail.error.message}):c({general:"Failed to create user. Please try again."})}finally{f(!1)}}},d=a=>o=>{const l=o.target.type==="checkbox"?o.target.checked:o.target.value;p(t=>({...t,[a]:l})),i[a]&&c(t=>({...t,[a]:void 0}))},E=w(r.password);return e.jsxs("div",{className:s.page,children:[e.jsxs("div",{className:s.pageHeader,children:[e.jsx("h1",{className:s.pageTitle,children:"Create New User"}),e.jsx("p",{className:s.pageDescription,children:"Create a new user account with appropriate role and permissions."})]}),e.jsxs("form",{onSubmit:k,className:s.form,children:[i.general&&e.jsx("div",{className:s.formError,style:{marginBottom:"var(--spacing-lg)"},children:i.general}),e.jsxs("div",{className:s.formSection,children:[e.jsx("h2",{className:s.sectionTitle,children:"Basic Information"}),e.jsxs("div",{className:s.formGrid,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:`${s.formLabel} ${s.required}`,children:"Login"}),e.jsx(h,{type:"text",value:r.login,onChange:d("login"),placeholder:"Enter username",className:s.formInput,error:!!i.login}),i.login&&e.jsx("div",{className:s.formError,children:i.login}),e.jsx("div",{className:s.formHelp,children:"Username for login. Only letters, numbers, hyphens, and underscores allowed."})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Email"}),e.jsx(h,{type:"email",value:r.email,onChange:d("email"),placeholder:"Enter email address",className:s.formInput,error:!!i.email}),i.email&&e.jsx("div",{className:s.formError,children:i.email}),e.jsx("div",{className:s.formHelp,children:"Optional email address for notifications."})]})]}),e.jsxs("div",{className:s.formGrid,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:`${s.formLabel} ${s.required}`,children:"Role"}),e.jsxs(C,{value:r.role,onChange:d("role"),className:s.formSelect,children:[e.jsx("option",{value:"reader",children:"Reader - View only access"}),e.jsx("option",{value:"editor",children:"Editor - Create and edit content"}),e.jsx("option",{value:"admin",children:"Admin - Full system access"})]}),e.jsx("div",{className:s.formHelp,children:"Determines user permissions and access level."})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Status"}),e.jsxs(C,{value:r.is_active?"active":"inactive",onChange:a=>p(o=>({...o,is_active:a.target.value==="active"})),className:s.formSelect,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsx("div",{className:s.formHelp,children:"Inactive users cannot log in to the system."})]})]})]}),e.jsxs("div",{className:s.formSection,children:[e.jsx("h2",{className:s.sectionTitle,children:"Password Settings"}),T&&e.jsxs("div",{className:s.passwordToggle,children:[e.jsxs("label",{className:s.passwordToggleLabel,children:[e.jsx("input",{type:"checkbox",checked:r.send_email,onChange:d("send_email"),className:s.formCheckboxInput}),"Send password setup link via email"]}),e.jsx("div",{className:`${s.passwordToggleSwitch} ${r.send_email?s.active:""}`,onClick:()=>p(a=>({...a,send_email:!a.send_email}))})]}),!r.send_email&&e.jsxs("div",{className:s.passwordField,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:`${s.formLabel} ${s.required}`,children:"Temporary Password"}),e.jsx(h,{type:"password",value:r.password,onChange:d("password"),placeholder:"Enter temporary password",className:s.formInput,error:!!i.password}),i.password&&e.jsx("div",{className:s.formError,children:i.password}),e.jsx("div",{className:s.formHelp,children:"User will be required to change this password on first login."})]}),e.jsxs("div",{className:s.passwordPolicy,children:[e.jsx("div",{className:s.passwordPolicyTitle,children:"Password Requirements:"}),e.jsx("ul",{className:s.passwordPolicyList,children:E.map((a,o)=>e.jsxs("li",{className:`${s.passwordPolicyItem} ${a.valid?s.valid:s.invalid}`,children:[e.jsx("span",{className:s.passwordPolicyIcon,children:a.valid?"âœ“":"âœ•"}),a.message]},o))})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",checked:r.require_password_change,onChange:d("require_password_change"),className:s.formCheckboxInput}),e.jsx("span",{className:s.formCheckboxLabel,children:"Require password change on first login"})]}),e.jsx("div",{className:s.formHelp,children:"User must set a new password when they first log in."})]})]}),e.jsxs("div",{className:s.formActions,children:[e.jsx(S,{type:"button",variant:"outline",onClick:()=>u("/admin/users"),disabled:g,children:"Cancel"}),e.jsx(S,{type:"submit",disabled:g,children:g?"Creating...":"Create User"})]})]})]})}export{we as CreateUserPage,we as default};
