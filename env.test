# ===== Backend .env for Docker Compose =====
# Usage: in docker-compose.yml -> services.<service>.env_file: ./.env

# --- Runtime mode ---
ENV=production
DEBUG=false

# --- Database ---
DB_URL=postgresql+psycopg2://postgres:postgres@postgres:5432/app
ASYNC_DB_URL=postgresql+asyncpg://postgres:postgres@postgres:5432/app

# --- Redis / Caching ---
REDIS_URL=redis://redis:6379/0

# --- Auth / JWT ---
JWT_SECRET=please-change-me
JWT_ALGORITHM=HS256
ACCESS_TOKEN_TTL_MINUTES=15
REFRESH_TOKEN_TTL_DAYS=30

# --- Password policy ---
PASSWORD_MIN_LENGTH=10
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_DIGITS=true
PASSWORD_REQUIRE_SPECIAL=false
PASSWORD_PEPPER=

# --- HTTP connectors (LLM / Embeddings) ---
LLM_BASE_URL=http://llm:8002
EMB_BASE_URL=http://emb:8001
HTTP_TIMEOUT_SECONDS=30
HTTP_MAX_RETRIES=2
TIMEOUT_SECONDS=30

# --- Circuit breaker ---
CB_LLM_FAILURES_THRESHOLD=5
CB_LLM_OPEN_TIMEOUT_SECONDS=30
CB_LLM_HALF_OPEN_MAX_CALLS=1
CB_EMB_FAILURES_THRESHOLD=5
CB_EMB_OPEN_TIMEOUT_SECONDS=30
CB_EMB_HALF_OPEN_MAX_CALLS=1

# --- Object storage (MinIO / S3) ---
S3_ENDPOINT=http://minio:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
# Keep both flags until code unified
S3_SECURE=false
S3_SSL=false
S3_BUCKET_RAG=rag-documents
S3_BUCKET_ARTIFACTS=rag-artifacts

# --- Vector DB (Qdrant) ---
QDRANT_URL=http://qdrant:6333

# --- Idempotency ---
IDEMPOTENCY_ENABLED=true
IDEMP_TTL_HOURS=24
IDEMPOTENCY_MAX_BYTES=1048576

# --- Workers (Celery) ---
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/1
BEAT=0

# --- Email (optional; add field to Settings or pass to client) ---
# EMAIL_FROM=no-reply@example.local
