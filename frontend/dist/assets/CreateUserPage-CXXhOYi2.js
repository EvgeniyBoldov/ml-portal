import{u as $,c as q,d as G,r as m,j as e}from"./index-By90sLri.js";import{a as N}from"./admin-DK_EKAlb.js";import{B as S}from"./Button-B5J9uU7E.js";import{I as u}from"./Input-BLoa0Skm.js";import{S as C}from"./Select-CgbhdMei.js";import"./idempotency-C3fxGORY.js";const H="_page_1062n_1",A="_pageHeader_1062n_6",F="_pageTitle_1062n_10",R="_pageDescription_1062n_17",D="_form_1062n_23",U="_formSection_1062n_30",O="_sectionTitle_1062n_38",B="_formGrid_1062n_47",z="_formGroup_1062n_53",Z="_formLabel_1062n_63",V="_required_1062n_69",J="_formInput_1062n_74",K="_formSelect_1062n_78",M="_formCheckbox_1062n_88",Q="_formCheckboxInput_1062n_95",W="_formCheckboxLabel_1062n_101",X="_formHelp_1062n_107",Y="_formError_1062n_113",ee="_passwordToggle_1062n_119",se="_passwordToggleLabel_1062n_130",ae="_passwordToggleSwitch_1062n_137",re="_active_1062n_147",oe="_passwordField_1062n_167",ie="_formActions_1062n_171",le="_passwordPolicy_1062n_180",ne="_passwordPolicyTitle_1062n_188",te="_passwordPolicyList_1062n_195",ce="_passwordPolicyItem_1062n_204",de="_valid_1062n_212",me="_invalid_1062n_216",pe="_passwordPolicyIcon_1062n_220",s={page:H,pageHeader:A,pageTitle:F,pageDescription:R,form:D,formSection:U,sectionTitle:O,formGrid:B,formGroup:z,formLabel:Z,required:V,formInput:J,formSelect:K,formCheckbox:M,formCheckboxInput:Q,formCheckboxLabel:W,formHelp:X,formError:Y,passwordToggle:ee,passwordToggleLabel:se,passwordToggleSwitch:ae,active:re,passwordField:oe,formActions:ie,passwordPolicy:le,passwordPolicyTitle:ne,passwordPolicyList:te,passwordPolicyItem:ce,valid:de,invalid:me,passwordPolicyIcon:pe};function ve(){const f=$();q();const P=G(),[r,p]=m.useState({login:"",email:"",role:"reader",is_active:!0,password:"",send_email:!0,require_password_change:!0}),[i,c]=m.useState({}),[_,g]=m.useState(!1),[T,I]=m.useState(!1);m.useEffect(()=>{(async()=>{try{const o=await N.getSystemStatus();I(o.email_enabled),o.email_enabled||p(l=>({...l,send_email:!1}))}catch(o){console.error("Failed to load system status:",o)}})()},[]);const w=a=>[{test:a.length>=8,message:"At least 8 characters"},{test:/[A-Z]/.test(a),message:"One uppercase letter"},{test:/[a-z]/.test(a),message:"One lowercase letter"},{test:/\d/.test(a),message:"One number"},{test:/[!@#$%^&*(),.?":{}|<>]/.test(a),message:"One special character"}].map(l=>({...l,valid:l.test})),L=()=>{const a={};return r.login.trim()?r.login.length<3?a.login="Login must be at least 3 characters":/^[a-zA-Z0-9_-]+$/.test(r.login)||(a.login="Login can only contain letters, numbers, hyphens, and underscores"):a.login="Login is required",r.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email)&&(a.email="Please enter a valid email address"),r.send_email||(r.password?w(r.password).filter(n=>!n.valid).length>0&&(a.password="Password does not meet requirements"):a.password="Password is required when not sending email"),c(a),Object.keys(a).length===0},k=async a=>{var o,l,n,v,x,j,b,y;if(a.preventDefault(),!!L()){g(!0),c({});try{const t={login:r.login.trim(),email:r.email.trim()||void 0,role:r.role,is_active:r.is_active,send_email:r.send_email};r.send_email||(t.password=r.password);const h=await N.createUser(t);P(`User ${r.login} created successfully${h.password?` with password: ${h.password}`:""}`),f(`/admin/users/${h.user.id}`)}catch(t){console.error("Failed to create user:",t),((v=(n=(l=(o=t.response)==null?void 0:o.data)==null?void 0:l.detail)==null?void 0:n.error)==null?void 0:v.code)==="user_exists"?c({login:"User with this login already exists"}):((y=(b=(j=(x=t.response)==null?void 0:x.data)==null?void 0:j.detail)==null?void 0:b.error)==null?void 0:y.code)==="invalid_password"?c({password:t.response.data.detail.error.message}):c({general:"Failed to create user. Please try again."})}finally{g(!1)}}},d=a=>o=>{const l=o.target.type==="checkbox"?o.target.checked:o.target.value;p(n=>({...n,[a]:l})),i[a]&&c(n=>({...n,[a]:void 0}))},E=w(r.password);return e.jsxs("div",{className:s.page,children:[e.jsxs("div",{className:s.pageHeader,children:[e.jsx("h1",{className:s.pageTitle,children:"Create New User"}),e.jsx("p",{className:s.pageDescription,children:"Create a new user account with appropriate role and permissions."})]}),e.jsxs("form",{onSubmit:k,className:s.form,children:[i.general&&e.jsx("div",{className:s.formError,style:{marginBottom:"var(--spacing-lg)"},children:i.general}),e.jsxs("div",{className:s.formSection,children:[e.jsx("h2",{className:s.sectionTitle,children:"Basic Information"}),e.jsxs("div",{className:s.formGrid,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:`${s.formLabel} ${s.required}`,children:"Login"}),e.jsx(u,{type:"text",value:r.login,onChange:d("login"),placeholder:"Enter username",className:s.formInput,error:!!i.login}),i.login&&e.jsx("div",{className:s.formError,children:i.login}),e.jsx("div",{className:s.formHelp,children:"Username for login. Only letters, numbers, hyphens, and underscores allowed."})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Email"}),e.jsx(u,{type:"email",value:r.email,onChange:d("email"),placeholder:"Enter email address",className:s.formInput,error:!!i.email}),i.email&&e.jsx("div",{className:s.formError,children:i.email}),e.jsx("div",{className:s.formHelp,children:"Optional email address for notifications."})]})]}),e.jsxs("div",{className:s.formGrid,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:`${s.formLabel} ${s.required}`,children:"Role"}),e.jsxs(C,{value:r.role,onChange:d("role"),className:s.formSelect,children:[e.jsx("option",{value:"reader",children:"Reader - View only access"}),e.jsx("option",{value:"editor",children:"Editor - Create and edit content"}),e.jsx("option",{value:"admin",children:"Admin - Full system access"})]}),e.jsx("div",{className:s.formHelp,children:"Determines user permissions and access level."})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Status"}),e.jsxs(C,{value:r.is_active?"active":"inactive",onChange:a=>p(o=>({...o,is_active:a.target.value==="active"})),className:s.formSelect,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsx("div",{className:s.formHelp,children:"Inactive users cannot log in to the system."})]})]})]}),e.jsxs("div",{className:s.formSection,children:[e.jsx("h2",{className:s.sectionTitle,children:"Password Settings"}),T&&e.jsxs("div",{className:s.passwordToggle,children:[e.jsxs("label",{className:s.passwordToggleLabel,children:[e.jsx("input",{type:"checkbox",checked:r.send_email,onChange:d("send_email"),className:s.formCheckboxInput}),"Send password setup link via email"]}),e.jsx("div",{className:`${s.passwordToggleSwitch} ${r.send_email?s.active:""}`,onClick:()=>p(a=>({...a,send_email:!a.send_email}))})]}),!r.send_email&&e.jsxs("div",{className:s.passwordField,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:`${s.formLabel} ${s.required}`,children:"Temporary Password"}),e.jsx(u,{type:"password",value:r.password,onChange:d("password"),placeholder:"Enter temporary password",className:s.formInput,error:!!i.password}),i.password&&e.jsx("div",{className:s.formError,children:i.password}),e.jsx("div",{className:s.formHelp,children:"User will be required to change this password on first login."})]}),e.jsxs("div",{className:s.passwordPolicy,children:[e.jsx("div",{className:s.passwordPolicyTitle,children:"Password Requirements:"}),e.jsx("ul",{className:s.passwordPolicyList,children:E.map((a,o)=>e.jsxs("li",{className:`${s.passwordPolicyItem} ${a.valid?s.valid:s.invalid}`,children:[e.jsx("span",{className:s.passwordPolicyIcon,children:a.valid?"âœ“":"âœ•"}),a.message]},o))})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",checked:r.require_password_change,onChange:d("require_password_change"),className:s.formCheckboxInput}),e.jsx("span",{className:s.formCheckboxLabel,children:"Require password change on first login"})]}),e.jsx("div",{className:s.formHelp,children:"User must set a new password when they first log in."})]})]}),e.jsxs("div",{className:s.formActions,children:[e.jsx(S,{type:"button",variant:"outline",onClick:()=>f("/admin/users"),disabled:_,children:"Cancel"}),e.jsx(S,{type:"submit",disabled:_,children:_?"Creating...":"Create User"})]})]})]})}export{ve as CreateUserPage,ve as default};
