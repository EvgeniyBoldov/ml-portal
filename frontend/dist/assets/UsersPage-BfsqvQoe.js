import{j as e,u as q,c as Q,d as V,r as n,L as J}from"./index-By90sLri.js";import{a as E}from"./admin-DK_EKAlb.js";import{R as K,S as W}from"./RoleBadge-lEcNlbir.js";import{B as h}from"./Button-B5J9uU7E.js";import{I as X}from"./Input-BLoa0Skm.js";import{S as D}from"./Select-CgbhdMei.js";import{S as Y}from"./Skeleton-CMKQVm89.js";import"./idempotency-C3fxGORY.js";const Z="_table_6tmhf_1",ee="_tableHeader_6tmhf_10",te="_tableHeaderCell_6tmhf_15",ae="_sortable_6tmhf_28",se="_active_6tmhf_38",le="_tableBody_6tmhf_42",ne="_tableRow_6tmhf_46",ie="_selected_6tmhf_55",re="_tableCell_6tmhf_59",oe="_compact_6tmhf_66",ce="_numeric_6tmhf_70",de="_actions_6tmhf_75",me="_emptyState_6tmhf_84",_e="_emptyStateIcon_6tmhf_90",he="_emptyStateTitle_6tmhf_96",ue="_emptyStateDescription_6tmhf_102",pe="_loadingCell_6tmhf_112",ge="_skeleton_6tmhf_118",fe="_short_6tmhf_126",xe="_medium_6tmhf_130",ve="_long_6tmhf_134",s={table:Z,tableHeader:ee,tableHeaderCell:te,sortable:ae,active:se,tableBody:le,tableRow:ne,selected:ie,tableCell:re,compact:oe,numeric:ce,actions:de,emptyState:me,emptyStateIcon:_e,emptyStateTitle:he,emptyStateDescription:ue,loadingCell:pe,skeleton:ge,short:fe,medium:xe,long:ve};function be({columns:u,data:m,loading:g=!1,emptyText:f="No data",emptyIcon:j,onRowClick:c,onRowDoubleClick:x,rowKey:v="id",selectedRowKeys:U=[],onSelectionChange:$,sortBy:y,sortOrder:p,onSort:A,className:R="",size:H="medium",stickyHeader:C=!0}){const I=(a,r)=>typeof v=="function"?v(a):String(a[v]||r),N=a=>{if(!A)return;A(a,y===a&&p==="asc"?"desc":"asc")},T=()=>e.jsx("tr",{children:e.jsxs("td",{colSpan:u.length,className:s.emptyState,children:[j&&e.jsx("div",{className:s.emptyStateIcon,children:j}),e.jsx("div",{className:s.emptyStateTitle,children:"No data"}),e.jsx("div",{className:s.emptyStateDescription,children:f})]})}),b=()=>Array.from({length:5}).map((a,r)=>e.jsx("tr",{children:u.map(S=>e.jsx("td",{className:`${s.tableCell} ${s.loadingCell}`,children:e.jsx("div",{className:`${s.skeleton} ${r%3===0?s.short:r%3===1?s.medium:s.long}`})},S.key))},r)),L=()=>e.jsx("thead",{className:s.tableHeader,children:e.jsx("tr",{children:u.map(a=>e.jsxs("th",{className:`
              ${s.tableHeaderCell}
              ${a.sortable?s.sortable:""}
              ${y===a.key?s.active:""}
              ${a.className||""}
            `,style:{width:a.width,textAlign:a.align||"left"},onClick:a.sortable?()=>N(a.key):void 0,children:[a.title,a.sortable&&y===a.key&&e.jsx("span",{style:{marginLeft:"4px"},children:p==="asc"?"â†‘":"â†“"})]},a.key))})}),F=()=>e.jsx("tbody",{className:s.tableBody,children:g?b():m.length===0?T():m.map((a,r)=>{const S=I(a,r),o=U.includes(S);return e.jsx("tr",{className:`${s.tableRow} ${o?s.selected:""}`,onClick:()=>c==null?void 0:c(a,r),onDoubleClick:()=>x==null?void 0:x(a,r),children:u.map(d=>{const _=d.dataIndex?a[d.dataIndex]:void 0,w=d.render?d.render(_,a,r):_;return e.jsx("td",{className:`
                      ${s.tableCell}
                      ${H==="small"?s.compact:""}
                      ${d.align==="right"?s.numeric:""}
                      ${d.key==="actions"?s.actions:""}
                      ${d.className||""}
                    `,style:{textAlign:d.align||"left"},children:w},d.key)})},S)})});return e.jsx("div",{className:`${s.tableContainer} ${R}`,children:e.jsxs("table",{className:s.table,children:[C&&L(),F()]})})}const Se="_page_14mse_1",je="_pageHeader_14mse_7",ye="_pageTitle_14mse_15",Ce="_pageActions_14mse_22",Ne="_filters_14mse_28",ke="_filterGroup_14mse_39",$e="_filterLabel_14mse_46",Ae="_filterActions_14mse_60",He="_tableContainer_14mse_67",Ie="_tableHeader_14mse_74",Te="_tableTitle_14mse_82",Le="_tableStats_14mse_89",we="_tableContent_14mse_94",Ue="_pagination_14mse_98",Fe="_paginationInfo_14mse_107",Be="_paginationControls_14mse_112",Ee="_loadingState_14mse_169",Re="_loadingSpinner_14mse_174",l={page:Se,pageHeader:je,pageTitle:ye,pageActions:Ce,filters:Ne,filterGroup:ke,filterLabel:$e,filterActions:Ae,tableContainer:He,tableHeader:Ie,tableTitle:Te,tableStats:Le,tableContent:we,pagination:Ue,paginationInfo:Fe,paginationControls:Be,loadingState:Ee,loadingSpinner:Re};function Ve(){const u=q(),m=Q(),g=V(),[f,j]=n.useState([]),[c,x]=n.useState(!0),[v,U]=n.useState(0),[$,y]=n.useState(!1),[p,A]=n.useState(),[R,H]=n.useState(),[C,I]=n.useState(""),[N,T]=n.useState(""),[b,L]=n.useState(""),[F,a]=n.useState("created_at"),[r,S]=n.useState("desc"),o=n.useCallback(async(t,i=!1)=>{try{x(!0);const B={query:C||void 0,role:N||void 0,is_active:b?b==="active":void 0,limit:20,cursor:t},k=await E.getUsers(B);i?(j(k.users),H(void 0)):j(O=>[...O,...k.users]),U(k.total),y(k.has_more),A(k.next_cursor)}catch(B){console.error("Failed to load users:",B),m("Failed to load users. Please try again.")}finally{x(!1)}},[C,N,b,m]),d=n.useCallback(()=>{$&&p&&!c&&(H(p),o(p,!1))},[$,p,c,o]),_=n.useCallback(()=>{o(void 0,!0)},[o]),w=n.useCallback(()=>{o(void 0,!0)},[o]),G=n.useCallback((t,i)=>{a(t),S(i),o(void 0,!0)},[o]),P=n.useCallback(async t=>{try{await E.updateUser(t.id,{is_active:!t.is_active}),g(`User ${t.login} ${t.is_active?"deactivated":"activated"} successfully`),_()}catch(i){console.error("Failed to toggle user status:",i),m("Failed to update user status. Please try again.")}},[g,m,_]),M=n.useCallback(async t=>{if(window.confirm(`Are you sure you want to deactivate user ${t.login}?`))try{await E.deleteUser(t.id),g(`User ${t.login} deactivated successfully`),_()}catch(i){console.error("Failed to delete user:",i),m("Failed to deactivate user. Please try again.")}},[g,m,_]);n.useEffect(()=>{o(void 0,!0)},[o]);const z=[{key:"login",title:"Login",dataIndex:"login",sortable:!0,render:(t,i)=>e.jsx(J,{to:`/admin/users/${i.id}`,className:"text-primary hover:text-primary-dark font-medium",children:t})},{key:"role",title:"Role",dataIndex:"role",sortable:!0,render:t=>e.jsx(K,{role:t})},{key:"email",title:"Email",dataIndex:"email",render:t=>t||e.jsx("span",{className:"text-text-tertiary",children:"â€”"})},{key:"is_active",title:"Status",dataIndex:"is_active",sortable:!0,render:t=>e.jsx(W,{active:t})},{key:"created_at",title:"Created",dataIndex:"created_at",sortable:!0,render:t=>new Date(t).toLocaleDateString()},{key:"actions",title:"Actions",render:(t,i)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{size:"small",variant:"outline",onClick:()=>u(`/admin/users/${i.id}`),children:"View"}),e.jsx(h,{size:"small",variant:"outline",onClick:()=>P(i),children:i.is_active?"Deactivate":"Activate"}),e.jsx(h,{size:"small",variant:"danger",onClick:()=>M(i),children:"Delete"})]})}];return e.jsxs("div",{className:l.page,children:[e.jsxs("div",{className:l.pageHeader,children:[e.jsx("h1",{className:l.pageTitle,children:"Users"}),e.jsxs("div",{className:l.pageActions,children:[e.jsx(h,{onClick:_,variant:"outline",children:"Refresh"}),e.jsx(h,{onClick:()=>u("/admin/users/new"),children:"Create User"})]})]}),e.jsxs("div",{className:l.filters,children:[e.jsxs("div",{className:l.filterGroup,children:[e.jsx("label",{className:l.filterLabel,children:"Search"}),e.jsx(X,{placeholder:"Search by login or email...",value:C,onChange:t=>I(t.target.value),onKeyPress:t=>t.key==="Enter"&&w()})]}),e.jsxs("div",{className:l.filterGroup,children:[e.jsx("label",{className:l.filterLabel,children:"Role"}),e.jsxs(D,{value:N,onChange:t=>T(t.target.value),children:[e.jsx("option",{value:"",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"reader",children:"Reader"})]})]}),e.jsxs("div",{className:l.filterGroup,children:[e.jsx("label",{className:l.filterLabel,children:"Status"}),e.jsxs(D,{value:b,onChange:t=>L(t.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:l.filterActions,children:[e.jsx(h,{onClick:w,variant:"outline",children:"Search"}),e.jsx(h,{onClick:()=>{I(""),T(""),L(""),o(void 0,!0)},variant:"outline",children:"Clear"})]})]}),e.jsxs("div",{className:l.tableContainer,children:[e.jsxs("div",{className:l.tableHeader,children:[e.jsx("h2",{className:l.tableTitle,children:"Users List"}),e.jsx("div",{className:l.tableStats,children:c?e.jsx(Y,{width:100}):`Showing ${f.length} of ${v} users`})]}),e.jsx("div",{className:l.tableContent,children:c&&f.length===0?e.jsxs("div",{className:l.loadingState,children:[e.jsx("div",{className:l.loadingSpinner}),e.jsx("p",{children:"Loading users..."})]}):e.jsx(be,{columns:z,data:f,loading:c,onSort:G,sortBy:F,sortOrder:r,emptyText:"No users found",emptyIcon:"ðŸ‘¥"})}),$&&e.jsxs("div",{className:l.pagination,children:[e.jsxs("div",{className:l.paginationInfo,children:["Showing ",f.length," of ",v," users"]}),e.jsx("div",{className:l.paginationControls,children:e.jsx(h,{onClick:d,disabled:c,variant:"outline",children:c?"Loading...":"Load More"})})]})]})]})}export{Ve as UsersPage,Ve as default};
