import{c as B,r as s,j as e}from"./index-By90sLri.js";import{a as H}from"./admin-DK_EKAlb.js";import{B as p}from"./Button-B5J9uU7E.js";import{I as m}from"./Input-BLoa0Skm.js";import{S as G}from"./Select-CgbhdMei.js";import{S as M}from"./Skeleton-CMKQVm89.js";import"./idempotency-C3fxGORY.js";const w="_page_n0dyb_1",F="_pageHeader_n0dyb_7",E="_pageTitle_n0dyb_15",$="_pageActions_n0dyb_22",P="_filters_n0dyb_28",U="_filterGroup_n0dyb_39",R="_filterLabel_n0dyb_46",O="_filterInput_n0dyb_52",q="_filterSelect_n0dyb_56",z="_filterActions_n0dyb_60",J="_tableContainer_n0dyb_67",K="_tableHeader_n0dyb_74",Q="_tableTitle_n0dyb_82",V="_tableStats_n0dyb_89",W="_tableContent_n0dyb_94",X="_auditItem_n0dyb_98",Y="_auditInfo_n0dyb_116",Z="_auditAction_n0dyb_121",ee="_auditDetails_n0dyb_128",te="_auditMeta_n0dyb_134",ae="_auditTime_n0dyb_142",se="_auditActions_n0dyb_149",ne="_actionBadge_n0dyb_155",ie="_create_n0dyb_166",oe="_update_n0dyb_171",le="_login_n0dyb_181",ce="_objectType_n0dyb_191",re="_objectId_n0dyb_196",de="_actorInfo_n0dyb_202",_e="_actorAvatar_n0dyb_208",ue="_actorName_n0dyb_221",pe="_systemActor_n0dyb_226",me="_pagination_n0dyb_231",be="_paginationInfo_n0dyb_240",he="_paginationControls_n0dyb_245",ye="_paginationButton_n0dyb_251",je="_active_n0dyb_272",ge="_emptyState_n0dyb_278",fe="_emptyStateIcon_n0dyb_284",xe="_emptyStateTitle_n0dyb_290",ve="_emptyStateDescription_n0dyb_297",Ne="_loadingState_n0dyb_302",Se="_loadingSpinner_n0dyb_307",Ae="_spin_n0dyb_1",t={page:w,pageHeader:F,pageTitle:E,pageActions:$,filters:P,filterGroup:U,filterLabel:R,filterInput:O,filterSelect:q,filterActions:z,tableContainer:J,tableHeader:K,tableTitle:Q,tableStats:V,tableContent:W,auditItem:X,auditInfo:Y,auditAction:Z,auditDetails:ee,auditMeta:te,auditTime:ae,auditActions:se,actionBadge:ne,create:ie,update:oe,delete:"_delete_n0dyb_176",login:le,default:"_default_n0dyb_186",objectType:ce,objectId:re,actorInfo:de,actorAvatar:_e,actorName:ue,systemActor:pe,pagination:me,paginationInfo:be,paginationControls:he,paginationButton:ye,active:je,emptyState:ge,emptyStateIcon:fe,emptyStateTitle:xe,emptyStateDescription:ve,loadingState:Ne,loadingSpinner:Se,spin:Ae};function Ge(){const h=B(),[c,y]=s.useState([]),[o,j]=s.useState(!0),[g,v]=s.useState(0),[b,N]=s.useState(!1),[u,S]=s.useState(),[Ie,f]=s.useState(),[n,x]=s.useState({actor_user_id:"",action:"",object_type:"",start_date:"",end_date:""}),i=s.useCallback(async(a,l=!1)=>{try{j(!0);const d={actor_user_id:n.actor_user_id||void 0,action:n.action||void 0,object_type:n.object_type||void 0,start_date:n.start_date||void 0,end_date:n.end_date||void 0,limit:50,cursor:a},_=await H.getAuditLogs(d);l?(y(_.logs),f(void 0)):y(k=>[...k,..._.logs]),v(_.total),N(_.has_more),S(_.next_cursor)}catch(d){console.error("Failed to load audit logs:",d),h("Failed to load audit logs. Please try again.")}finally{j(!1)}},[n,h]),A=s.useCallback(()=>{b&&u&&!o&&(f(u),i(u,!1))},[b,u,o,i]),I=s.useCallback(()=>{i(void 0,!0)},[i]),C=s.useCallback(()=>{i(void 0,!0)},[i]),r=a=>l=>{x(d=>({...d,[a]:l.target.value}))};s.useEffect(()=>{i(void 0,!0)},[i]);const T=a=>a.includes("create")||a.includes("created")?"create":a.includes("update")||a.includes("updated")?"update":a.includes("delete")||a.includes("deleted")?"delete":a.includes("login")||a.includes("auth")?"login":"default",L=a=>a?a.slice(0,2).toUpperCase():"S",D=a=>a.split("_").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" ");return e.jsxs("div",{className:t.page,children:[e.jsxs("div",{className:t.pageHeader,children:[e.jsx("h1",{className:t.pageTitle,children:"Audit Log"}),e.jsx("div",{className:t.pageActions,children:e.jsx(p,{onClick:I,variant:"outline",children:"Refresh"})})]}),e.jsxs("div",{className:t.filters,children:[e.jsxs("div",{className:t.filterGroup,children:[e.jsx("label",{className:t.filterLabel,children:"Actor"}),e.jsx(m,{placeholder:"User ID or login...",value:n.actor_user_id,onChange:r("actor_user_id"),className:t.filterInput})]}),e.jsxs("div",{className:t.filterGroup,children:[e.jsx("label",{className:t.filterLabel,children:"Action"}),e.jsx(m,{placeholder:"Action name...",value:n.action,onChange:r("action"),className:t.filterInput})]}),e.jsxs("div",{className:t.filterGroup,children:[e.jsx("label",{className:t.filterLabel,children:"Object Type"}),e.jsxs(G,{value:n.object_type,onChange:r("object_type"),className:t.filterSelect,children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"token",children:"Token"}),e.jsx("option",{value:"password",children:"Password"}),e.jsx("option",{value:"auth",children:"Authentication"})]})]}),e.jsxs("div",{className:t.filterGroup,children:[e.jsx("label",{className:t.filterLabel,children:"Start Date"}),e.jsx(m,{type:"datetime-local",value:n.start_date,onChange:r("start_date"),className:t.filterInput})]}),e.jsxs("div",{className:t.filterGroup,children:[e.jsx("label",{className:t.filterLabel,children:"End Date"}),e.jsx(m,{type:"datetime-local",value:n.end_date,onChange:r("end_date"),className:t.filterInput})]}),e.jsxs("div",{className:t.filterActions,children:[e.jsx(p,{onClick:C,variant:"outline",children:"Search"}),e.jsx(p,{onClick:()=>{x({actor_user_id:"",action:"",object_type:"",start_date:"",end_date:""}),i(void 0,!0)},variant:"outline",children:"Clear"})]})]}),e.jsxs("div",{className:t.tableContainer,children:[e.jsxs("div",{className:t.tableHeader,children:[e.jsx("h2",{className:t.tableTitle,children:"Audit Logs"}),e.jsx("div",{className:t.tableStats,children:o?e.jsx(M,{width:100}):`Showing ${c.length} of ${g} logs`})]}),e.jsx("div",{className:t.tableContent,children:o&&c.length===0?e.jsxs("div",{className:t.loadingState,children:[e.jsx("div",{className:t.loadingSpinner}),e.jsx("p",{children:"Loading audit logs..."})]}):c.length===0?e.jsxs("div",{className:t.emptyState,children:[e.jsx("div",{className:t.emptyStateIcon,children:"ðŸ“‹"}),e.jsx("div",{className:t.emptyStateTitle,children:"No audit logs"}),e.jsx("div",{className:t.emptyStateDescription,children:"No audit logs found matching your criteria."})]}):e.jsx("div",{children:c.map(a=>e.jsxs("div",{className:t.auditItem,children:[e.jsxs("div",{className:t.auditInfo,children:[e.jsx("div",{className:t.auditAction,children:e.jsx("span",{className:`${t.actionBadge} ${t[T(a.action)]}`,children:D(a.action)})}),e.jsx("div",{className:t.auditDetails,children:a.object_type&&a.object_id&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:t.objectType,children:a.object_type}),e.jsxs("span",{className:t.objectId,children:[" (",a.object_id,")"]})]})}),e.jsxs("div",{className:t.auditMeta,children:[e.jsxs("div",{className:t.actorInfo,children:[e.jsx("div",{className:t.actorAvatar,children:L(a.actor_user_id)}),e.jsx("span",{className:a.actor_user_id?t.actorName:t.systemActor,children:a.actor_user_id?`User ${a.actor_user_id.slice(0,8)}`:"System"})]}),a.ip&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["IP: ",a.ip]})]}),a.user_agent&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{title:a.user_agent,children:a.user_agent.length>50?`${a.user_agent.slice(0,50)}...`:a.user_agent})]})]})]}),e.jsx("div",{className:t.auditTime,children:new Date(a.ts).toLocaleString()})]},a.id))})}),b&&e.jsxs("div",{className:t.pagination,children:[e.jsxs("div",{className:t.paginationInfo,children:["Showing ",c.length," of ",g," logs"]}),e.jsx("div",{className:t.paginationControls,children:e.jsx(p,{onClick:A,disabled:o,variant:"outline",children:o?"Loading...":"Load More"})})]})]})]})}export{Ge as AuditPage,Ge as default};
