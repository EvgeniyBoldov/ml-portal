import{j as e,u as O,c as q,d as Q,r as i,L as V}from"./index-FkM6qUsl.js";import{a as R}from"./admin-DK_EKAlb.js";import{R as J,S as K}from"./RoleBadge-BSPkwMV4.js";import{B as g}from"./Button-t5z5qQ-u.js";import{I as W}from"./Input-THmdJdCV.js";import{S as D}from"./Select-CqlyniY_.js";import{S as X}from"./Skeleton-3MZmQPtS.js";import"./idempotency-C3fxGORY.js";const Y="_table_iel9c_1",Z="_tableHeader_iel9c_10",ee="_tableHeaderCell_iel9c_15",te="_sortable_iel9c_28",ae="_active_iel9c_38",se="_tableBody_iel9c_42",le="_tableRow_iel9c_46",ie="_selected_iel9c_55",ne="_tableCell_iel9c_59",re="_compact_iel9c_66",ce="_numeric_iel9c_70",oe="_actions_iel9c_75",de="_emptyState_iel9c_84",_e="_emptyStateIcon_iel9c_90",ge="_emptyStateTitle_iel9c_96",ue="_emptyStateDescription_iel9c_102",pe="_loadingCell_iel9c_112",he="_skeleton_iel9c_118",me="_short_iel9c_131",xe="_medium_iel9c_135",ve="_long_iel9c_139",s={table:Y,tableHeader:Z,tableHeaderCell:ee,sortable:te,active:ae,tableBody:se,tableRow:le,selected:ie,tableCell:ne,compact:re,numeric:ce,actions:oe,emptyState:de,emptyStateIcon:_e,emptyStateTitle:ge,emptyStateDescription:ue,loadingCell:pe,skeleton:he,short:me,medium:xe,long:ve};function be({columns:u,data:_,loading:h=!1,emptyText:m="No data",emptyIcon:S,onRowClick:d,onRowDoubleClick:x,rowKey:v="id",selectedRowKeys:L=[],_onSelectionChange:N,sortBy:j,sortOrder:p,onSort:$,className:A="",size:y="medium",stickyHeader:H=!0}){const f=(a,o)=>typeof v=="function"?v(a):String(a[v]||o),I=a=>{if(!$)return;$(a,j===a&&p==="asc"?"desc":"asc")},b=()=>e.jsx("tr",{children:e.jsxs("td",{colSpan:u.length,className:s.emptyState,children:[S&&e.jsx("div",{className:s.emptyStateIcon,children:S}),e.jsx("div",{className:s.emptyStateTitle,children:"No data"}),e.jsx("div",{className:s.emptyStateDescription,children:m})]})}),T=()=>Array.from({length:5}).map((a,o)=>e.jsx("tr",{children:u.map(n=>e.jsx("td",{className:`${s.tableCell} ${s.loadingCell}`,children:e.jsx("div",{className:`${s.skeleton} ${o%3===0?s.short:o%3===1?s.medium:s.long}`})},n.key))},o)),w=()=>e.jsx("thead",{className:s.tableHeader,children:e.jsx("tr",{children:u.map(a=>e.jsxs("th",{className:`
              ${s.tableHeaderCell}
              ${a.sortable?s.sortable:""}
              ${j===a.key?s.active:""}
              ${a.className||""}
            `,style:{width:a.width,textAlign:a.align||"left"},onClick:a.sortable?()=>I(a.key):void 0,children:[a.title,a.sortable&&j===a.key&&e.jsx("span",{style:{marginLeft:"4px"},children:p==="asc"?"â†‘":"â†“"})]},a.key))})}),U=()=>e.jsx("tbody",{className:s.tableBody,children:h?T():_.length===0?b():_.map((a,o)=>{const n=f(a,o),F=L.includes(n);return e.jsx("tr",{className:`${s.tableRow} ${F?s.selected:""}`,onClick:()=>d==null?void 0:d(a,o),onDoubleClick:()=>x==null?void 0:x(a,o),children:u.map(r=>{const k=r.dataIndex?a[r.dataIndex]:void 0,B=r.render?r.render(k,a,o):k;return e.jsx("td",{className:`
                      ${s.tableCell}
                      ${y==="small"?s.compact:""}
                      ${r.align==="right"?s.numeric:""}
                      ${r.key==="actions"?s.actions:""}
                      ${r.className||""}
                    `,style:{textAlign:r.align||"left"},children:B},r.key)})},n)})});return e.jsx("div",{className:`${s.tableContainer} ${A}`,children:e.jsxs("table",{className:s.table,children:[H&&w(),U()]})})}const Se="_page_18ckg_1",je="_pageHeader_18ckg_7",ye="_pageTitle_18ckg_15",fe="_pageActions_18ckg_22",ke="_filters_18ckg_28",Ce="_filterGroup_18ckg_39",Ne="_filterLabel_18ckg_46",$e="_filterActions_18ckg_60",Ae="_tableContainer_18ckg_67",He="_tableHeader_18ckg_74",Ie="_tableTitle_18ckg_82",Te="_tableStats_18ckg_89",Le="_tableContent_18ckg_94",we="_pagination_18ckg_98",Ue="_paginationInfo_18ckg_107",Fe="_paginationControls_18ckg_112",Be="_loadingState_18ckg_169",Ee="_loadingSpinner_18ckg_174",l={page:Se,pageHeader:je,pageTitle:ye,pageActions:fe,filters:ke,filterGroup:Ce,filterLabel:Ne,filterActions:$e,tableContainer:Ae,tableHeader:He,tableTitle:Ie,tableStats:Te,tableContent:Le,pagination:we,paginationInfo:Ue,paginationControls:Fe,loadingState:Be,loadingSpinner:Ee};function Qe(){const u=O(),_=q(),h=Q(),[m,S]=i.useState([]),[d,x]=i.useState(!0),[v,L]=i.useState(0),[N,j]=i.useState(!1),[p,$]=i.useState(),[,A]=i.useState(),[y,H]=i.useState(""),[f,I]=i.useState(""),[b,T]=i.useState(""),[w,U]=i.useState("created_at"),[a,o]=i.useState("desc"),n=i.useCallback(async(t,c=!1)=>{try{x(!0);const E={query:y||void 0,role:f||void 0,is_active:b?b==="active":void 0,limit:20,cursor:t},C=await R.getUsers(E);c?(S(C.users),A(void 0)):S(z=>[...z,...C.users]),L(C.total||0),j(C.has_more),$(C.next_cursor)}catch(E){console.error("Failed to load users:",E),_("Failed to load users. Please try again.")}finally{x(!1)}},[y,f,b,_]),F=i.useCallback(()=>{N&&p&&!d&&(A(p),n(p,!1))},[N,p,d,n]),r=i.useCallback(()=>{n(void 0,!0)},[n]),k=i.useCallback(()=>{n(void 0,!0)},[n]),B=i.useCallback((t,c)=>{U(t),o(c),n(void 0,!0)},[n]),G=i.useCallback(async t=>{try{await R.updateUser(t.id,{is_active:!t.is_active}),h(`User ${t.login} ${t.is_active?"deactivated":"activated"} successfully`),r()}catch(c){console.error("Failed to toggle user status:",c),_("Failed to update user status. Please try again.")}},[h,_,r]),P=i.useCallback(async t=>{if(window.confirm(`Are you sure you want to deactivate user ${t.login}?`))try{await R.deleteUser(t.id),h(`User ${t.login} deactivated successfully`),r()}catch(c){console.error("Failed to delete user:",c),_("Failed to deactivate user. Please try again.")}},[h,_,r]);i.useEffect(()=>{n(void 0,!0)},[n]);const M=[{key:"login",title:"Login",dataIndex:"login",sortable:!0,render:(t,c)=>e.jsx(V,{to:`/admin/users/${c.id}`,className:"text-primary hover:text-primary-dark font-medium",children:t})},{key:"role",title:"Role",dataIndex:"role",sortable:!0,render:t=>e.jsx(J,{role:t})},{key:"email",title:"Email",dataIndex:"email",render:t=>t||e.jsx("span",{className:"text-text-tertiary",children:"â€”"})},{key:"is_active",title:"Status",dataIndex:"is_active",sortable:!0,render:t=>e.jsx(K,{active:t})},{key:"created_at",title:"Created",dataIndex:"created_at",sortable:!0,render:t=>new Date(t).toLocaleDateString()},{key:"actions",title:"Actions",render:(t,c)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{size:"small",variant:"outline",onClick:()=>u(`/admin/users/${c.id}`),children:"View"}),e.jsx(g,{size:"small",variant:"outline",onClick:()=>G(c),children:c.is_active?"Deactivate":"Activate"}),e.jsx(g,{size:"small",variant:"danger",onClick:()=>P(c),children:"Delete"})]})}];return e.jsxs("div",{className:l.page,children:[e.jsxs("div",{className:l.pageHeader,children:[e.jsx("h1",{className:l.pageTitle,children:"Users"}),e.jsxs("div",{className:l.pageActions,children:[e.jsx(g,{onClick:r,variant:"outline",children:"Refresh"}),e.jsx(g,{onClick:()=>u("/admin/users/new"),children:"Create User"})]})]}),e.jsxs("div",{className:l.filters,children:[e.jsxs("div",{className:l.filterGroup,children:[e.jsx("label",{className:l.filterLabel,children:"Search"}),e.jsx(W,{placeholder:"Search by login or email...",value:y,onChange:t=>H(t.target.value),onKeyPress:t=>t.key==="Enter"&&k()})]}),e.jsxs("div",{className:l.filterGroup,children:[e.jsx("label",{className:l.filterLabel,children:"Role"}),e.jsxs(D,{value:f,onChange:t=>I(t.target.value),children:[e.jsx("option",{value:"",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"reader",children:"Reader"})]})]}),e.jsxs("div",{className:l.filterGroup,children:[e.jsx("label",{className:l.filterLabel,children:"Status"}),e.jsxs(D,{value:b,onChange:t=>T(t.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:l.filterActions,children:[e.jsx(g,{onClick:k,variant:"outline",children:"Search"}),e.jsx(g,{onClick:()=>{H(""),I(""),T(""),n(void 0,!0)},variant:"outline",children:"Clear"})]})]}),e.jsxs("div",{className:l.tableContainer,children:[e.jsxs("div",{className:l.tableHeader,children:[e.jsx("h2",{className:l.tableTitle,children:"Users List"}),e.jsx("div",{className:l.tableStats,children:d?e.jsx(X,{width:100}):`Showing ${m.length} of ${v} users`})]}),e.jsx("div",{className:l.tableContent,children:d&&m.length===0?e.jsxs("div",{className:l.loadingState,children:[e.jsx("div",{className:l.loadingSpinner}),e.jsx("p",{children:"Loading users..."})]}):e.jsx(be,{columns:M,data:m,loading:d,onSort:B,sortBy:w,sortOrder:a,emptyText:"No users found",emptyIcon:"ðŸ‘¥"})}),N&&e.jsxs("div",{className:l.pagination,children:[e.jsxs("div",{className:l.paginationInfo,children:["Showing ",m.length," of ",v," users"]}),e.jsx("div",{className:l.paginationControls,children:e.jsx(g,{onClick:F,disabled:d,variant:"outline",children:d?"Loading...":"Load More"})})]})]})]})}export{Qe as UsersPage,Qe as default};
