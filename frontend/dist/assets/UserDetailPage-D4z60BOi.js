import{a as q,u as B,c as z,d as O,r as n,j as e}from"./index-FkM6qUsl.js";import{T as K,a as d}from"./admin-DK_EKAlb.js";import{R as D,S as A}from"./RoleBadge-BSPkwMV4.js";import{B as o}from"./Button-t5z5qQ-u.js";import{I as h}from"./Input-THmdJdCV.js";import{S as M}from"./Select-CqlyniY_.js";import{M as Y}from"./Modal-Cg6TzCa0.js";import"./idempotency-C3fxGORY.js";const J="_page_18v4p_1",Q="_pageHeader_18v4p_7",V="_pageTitle_18v4p_15",W="_pageActions_18v4p_22",X="_tabs_18v4p_28",Z="_tab_18v4p_28",ee="_active_18v4p_50",se="_tabContent_18v4p_55",te="_section_18v4p_63",ae="_sectionTitle_18v4p_75",ie="_sectionContent_18v4p_84",ne="_formGroup_18v4p_90",oe="_formLabel_18v4p_100",re="_required_18v4p_106",ce="_formInput_18v4p_111",le="_formSelect_18v4p_115",de="_formCheckbox_18v4p_125",me="_formCheckboxInput_18v4p_132",pe="_formCheckboxLabel_18v4p_138",ue="_formHelp_18v4p_144",ve="_formActions_18v4p_156",_e="_userInfo_18v4p_165",he="_userAvatar_18v4p_172",xe="_userDetails_18v4p_185",je="_userName_18v4p_189",fe="_userRole_18v4p_196",Ne="_userMeta_18v4p_200",ke="_userMetaItem_18v4p_205",ge="_tokensList_18v4p_213",Se="_tokenItem_18v4p_219",be="_tokenInfo_18v4p_230",ye="_tokenName_18v4p_235",Ce="_tokenScopes_18v4p_242",Ie="_tokenScope_18v4p_242",Te="_tokenMeta_18v4p_258",Le="_tokenActions_18v4p_263",we="_auditList_18v4p_269",De="_auditItem_18v4p_275",Ae="_auditInfo_18v4p_286",Me="_auditAction_18v4p_291",$e="_auditDetails_18v4p_298",Fe="_auditMeta_18v4p_304",Pe="_auditTime_18v4p_309",Re="_emptyState_18v4p_315",Ue="_emptyStateIcon_18v4p_321",Ee="_emptyStateTitle_18v4p_327",He="_emptyStateDescription_18v4p_334",Ge="_loadingState_18v4p_339",qe="_loadingSpinner_18v4p_344",s={page:J,pageHeader:Q,pageTitle:V,pageActions:W,tabs:X,tab:Z,active:ee,tabContent:se,section:te,sectionTitle:ae,sectionContent:ie,formGroup:ne,formLabel:oe,required:re,formInput:ce,formSelect:le,formCheckbox:de,formCheckboxInput:me,formCheckboxLabel:pe,formHelp:ue,formActions:ve,userInfo:_e,userAvatar:he,userDetails:xe,userName:je,userRole:fe,userMeta:Ne,userMetaItem:ke,tokensList:ge,tokenItem:Se,tokenInfo:be,tokenName:ye,tokenScopes:Ce,tokenScope:Ie,tokenMeta:Te,tokenActions:Le,auditList:we,auditItem:De,auditInfo:Ae,auditAction:Me,auditDetails:$e,auditMeta:Fe,auditTime:Pe,emptyState:Re,emptyStateIcon:Ue,emptyStateTitle:Ee,emptyStateDescription:He,loadingState:Ge,loadingSpinner:qe};function We(){const{id:u}=q(),y=B(),m=z(),p=O(),[i,C]=n.useState(null),[k,g]=n.useState([]),[I,$]=n.useState([]),[F,T]=n.useState(!0),[c,x]=n.useState("profile"),[j,S]=n.useState(!1),[L,w]=n.useState(!1),[f,v]=n.useState({role:"reader",email:"",is_active:!0}),[P,N]=n.useState(!1),[l,_]=n.useState({name:"",scopes:[],expires_at:""});n.useEffect(()=>{if(!u)return;(async()=>{try{T(!0);const[a,r,b]=await Promise.all([d.getUser(u),d.getUserTokens(u),d.getAuditLogs({actor_user_id:u,limit:10})]);C(a),g(r.tokens),$(b.logs),v({role:a.role,email:a.email||"",is_active:a.is_active})}catch(a){console.error("Failed to load user data:",a),m("Failed to load user data. Please try again.")}finally{T(!1)}})()},[u,m]);const R=async()=>{if(i)try{w(!0);const t=await d.updateUser(i.id,f);C(t),S(!1),p("User updated successfully")}catch(t){console.error("Failed to update user:",t),m("Failed to update user. Please try again.")}finally{w(!1)}},U=async()=>{if(i&&window.confirm(`Reset password for user ${i.login}?`))try{const t=await d.resetUserPassword(i.id,{});t.password?p(`Password reset successfully. New password: ${t.password}`):p("Password reset email sent successfully")}catch(t){console.error("Failed to reset password:",t),m("Failed to reset password. Please try again.")}},E=async()=>{if(i)try{const t=await d.createUserToken(i.id,{name:l.name,scopes:l.scopes,expires_at:l.expires_at||void 0});g(a=>[...a,t]),N(!1),_({name:"",scopes:[],expires_at:""}),t.token_plain_once?p(`Token created successfully: ${t.token_plain_once}`):p("Token created successfully")}catch(t){console.error("Failed to create token:",t),m("Failed to create token. Please try again.")}},H=async t=>{if(window.confirm("Are you sure you want to revoke this token?"))try{await d.revokeToken(t),g(a=>a.filter(r=>r.id!==t)),p("Token revoked successfully")}catch(a){console.error("Failed to revoke token:",a),m("Failed to revoke token. Please try again.")}};if(F)return e.jsx("div",{className:s.page,children:e.jsxs("div",{className:s.loadingState,children:[e.jsx("div",{className:s.loadingSpinner}),e.jsx("p",{children:"Loading user data..."})]})});if(!i)return e.jsx("div",{className:s.page,children:e.jsxs("div",{className:s.emptyState,children:[e.jsx("div",{className:s.emptyStateIcon,children:"ðŸ‘¤"}),e.jsx("div",{className:s.emptyStateTitle,children:"User not found"}),e.jsx("div",{className:s.emptyStateDescription,children:"The requested user could not be found."}),e.jsx(o,{onClick:()=>y("/admin/users"),children:"Back to Users"})]})});const G=t=>t.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2);return e.jsxs("div",{className:s.page,children:[e.jsxs("div",{className:s.pageHeader,children:[e.jsx("h1",{className:s.pageTitle,children:"User Details"}),e.jsxs("div",{className:s.pageActions,children:[e.jsx(o,{variant:"outline",onClick:()=>y("/admin/users"),children:"Back to Users"}),j?e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",onClick:()=>{S(!1),v({role:i.role,email:i.email||"",is_active:i.is_active})},children:"Cancel"}),e.jsx(o,{onClick:R,disabled:L,children:L?"Saving...":"Save Changes"})]}):e.jsx(o,{onClick:()=>S(!0),children:"Edit User"})]})]}),e.jsxs("div",{className:s.userInfo,children:[e.jsx("div",{className:s.userAvatar,children:G(i.login)}),e.jsxs("div",{className:s.userDetails,children:[e.jsx("h2",{className:s.userName,children:i.login}),e.jsx("div",{className:s.userRole,children:e.jsx(D,{role:i.role,size:"large"})}),e.jsxs("div",{className:s.userMeta,children:[e.jsxs("div",{className:s.userMetaItem,children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(A,{active:i.is_active})]}),e.jsxs("div",{className:s.userMetaItem,children:[e.jsx("strong",{children:"Email:"})," ",i.email||"Not provided"]}),e.jsxs("div",{className:s.userMetaItem,children:[e.jsx("strong",{children:"Created:"})," ",new Date(i.created_at).toLocaleDateString()]}),e.jsxs("div",{className:s.userMetaItem,children:[e.jsx("strong",{children:"Last Updated:"})," ",new Date(i.updated_at).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:s.tabs,children:[e.jsx("button",{className:`${s.tab} ${c==="profile"?s.active:""}`,onClick:()=>x("profile"),children:"Profile"}),e.jsx("button",{className:`${s.tab} ${c==="security"?s.active:""}`,onClick:()=>x("security"),children:"Security"}),e.jsxs("button",{className:`${s.tab} ${c==="tokens"?s.active:""}`,onClick:()=>x("tokens"),children:["Tokens (",k.length,")"]}),e.jsx("button",{className:`${s.tab} ${c==="audit"?s.active:""}`,onClick:()=>x("audit"),children:"Audit"})]}),e.jsx("div",{className:`${s.tabContent} ${c==="profile"?s.active:""}`,children:e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Profile Information"}),e.jsxs("div",{className:s.sectionContent,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Login"}),e.jsx(h,{value:i.login,disabled:!0,className:s.formInput}),e.jsx("div",{className:s.formHelp,children:"Username cannot be changed after creation."})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Email"}),j?e.jsx(h,{type:"email",value:f.email,onChange:t=>v(a=>({...a,email:t.target.value})),className:s.formInput}):e.jsx(h,{value:i.email||"Not provided",disabled:!0,className:s.formInput})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Role"}),j?e.jsxs(M,{value:f.role,onChange:t=>v(a=>({...a,role:t.target.value})),className:s.formSelect,children:[e.jsx("option",{value:"reader",children:"Reader"}),e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"admin",children:"Admin"})]}):e.jsx("div",{children:e.jsx(D,{role:i.role})})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Status"}),j?e.jsxs(M,{value:f.is_active?"active":"inactive",onChange:t=>v(a=>({...a,is_active:t.target.value==="active"})),className:s.formSelect,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}):e.jsx("div",{children:e.jsx(A,{active:i.is_active})})]})]})]})}),e.jsx("div",{className:`${s.tabContent} ${c==="security"?s.active:""}`,children:e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Security Settings"}),e.jsx("div",{className:s.sectionContent,children:e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Password Reset"}),e.jsx("div",{className:s.formHelp,children:"Reset the user's password. They will be required to change it on next login."}),e.jsx(o,{variant:"outline",onClick:U,children:"Reset Password"})]})})]})}),e.jsx("div",{className:`${s.tabContent} ${c==="tokens"?s.active:""}`,children:e.jsxs("div",{className:s.section,children:[e.jsxs("div",{className:s.sectionTitle,children:["Personal Access Tokens",e.jsx(o,{size:"small",onClick:()=>N(!0),style:{marginLeft:"var(--spacing-md)"},children:"Create Token"})]}),k.length===0?e.jsxs("div",{className:s.emptyState,children:[e.jsx("div",{className:s.emptyStateIcon,children:"ðŸ”‘"}),e.jsx("div",{className:s.emptyStateTitle,children:"No tokens"}),e.jsx("div",{className:s.emptyStateDescription,children:"This user has no personal access tokens."})]}):e.jsx("div",{className:s.tokensList,children:k.map(t=>e.jsxs("div",{className:s.tokenItem,children:[e.jsxs("div",{className:s.tokenInfo,children:[e.jsx("div",{className:s.tokenName,children:t.name}),e.jsx("div",{className:s.tokenScopes,children:t.scopes.map(a=>e.jsx("span",{className:s.tokenScope,children:a.scope},a.scope))}),e.jsxs("div",{className:s.tokenMeta,children:["Created: ",new Date(t.created_at).toLocaleDateString(),t.expires_at&&e.jsxs(e.Fragment,{children:[" ","â€¢ Expires:"," ",new Date(t.expires_at).toLocaleDateString()]}),t.last_used_at&&e.jsxs(e.Fragment,{children:[" ","â€¢ Last used:"," ",new Date(t.last_used_at).toLocaleDateString()]}),t.revoked_at&&e.jsxs(e.Fragment,{children:[" ","â€¢ Revoked:"," ",new Date(t.revoked_at).toLocaleDateString()]})]})]}),e.jsx("div",{className:s.tokenActions,children:!t.revoked_at&&e.jsx(o,{size:"small",variant:"danger",onClick:()=>H(t.id),children:"Revoke"})})]},t.id))})]})}),e.jsx("div",{className:`${s.tabContent} ${c==="audit"?s.active:""}`,children:e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Recent Activity"}),I.length===0?e.jsxs("div",{className:s.emptyState,children:[e.jsx("div",{className:s.emptyStateIcon,children:"ðŸ“‹"}),e.jsx("div",{className:s.emptyStateTitle,children:"No activity"}),e.jsx("div",{className:s.emptyStateDescription,children:"No recent activity found for this user."})]}):e.jsx("div",{className:s.auditList,children:I.map(t=>e.jsxs("div",{className:s.auditItem,children:[e.jsxs("div",{className:s.auditInfo,children:[e.jsx("div",{className:s.auditAction,children:t.action}),e.jsx("div",{className:s.auditDetails,children:t.object_type&&t.object_id&&e.jsxs(e.Fragment,{children:["Object: ",t.object_type," (",t.object_id,")"]})}),e.jsxs("div",{className:s.auditMeta,children:[t.ip&&e.jsxs(e.Fragment,{children:["IP: ",t.ip]}),t.user_agent&&e.jsxs(e.Fragment,{children:[" â€¢ ",t.user_agent]})]})]}),e.jsx("div",{className:s.auditTime,children:new Date(t.ts).toLocaleString()})]},t.id))})]})}),e.jsxs(Y,{open:P,onClose:()=>N(!1),title:"Create Personal Access Token",children:[e.jsxs("div",{className:s.sectionContent,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:`${s.formLabel} ${s.required}`,children:"Token Name"}),e.jsx(h,{value:l.name,onChange:t=>_(a=>({...a,name:t.target.value})),placeholder:"Enter token name",className:s.formInput})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:`${s.formLabel} ${s.required}`,children:"Scopes"}),e.jsx("div",{className:s.formHelp,children:"Select the permissions this token should have."}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid var(--color-border)",borderRadius:"var(--border-radius)",padding:"var(--spacing-sm)"},children:K.map(t=>e.jsxs("label",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",checked:l.scopes.includes(t.scope),onChange:a=>{a.target.checked?_(r=>({...r,scopes:[...r.scopes,t.scope]})):_(r=>({...r,scopes:r.scopes.filter(b=>b!==t.scope)}))},className:s.formCheckboxInput}),e.jsxs("span",{className:s.formCheckboxLabel,children:[e.jsx("strong",{children:t.scope})," - ",t.description]})]},t.scope))})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Expires At"}),e.jsx(h,{type:"datetime-local",value:l.expires_at,onChange:t=>_(a=>({...a,expires_at:t.target.value})),className:s.formInput}),e.jsx("div",{className:s.formHelp,children:"Leave empty for no expiration."})]})]}),e.jsxs("div",{className:s.formActions,children:[e.jsx(o,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(o,{onClick:E,disabled:!l.name||l.scopes.length===0,children:"Create Token"})]})]})]})}export{We as UserDetailPage,We as default};
