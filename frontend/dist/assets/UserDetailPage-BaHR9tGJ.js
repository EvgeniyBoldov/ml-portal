import{a as q,u as B,c as z,d as O,r as n,j as e}from"./index-By90sLri.js";import{T as K,a as d}from"./admin-DK_EKAlb.js";import{R as D,S as A}from"./RoleBadge-lEcNlbir.js";import{B as o}from"./Button-B5J9uU7E.js";import{I as x}from"./Input-BLoa0Skm.js";import{S as M}from"./Select-CgbhdMei.js";import{M as Y}from"./Modal-D9yt7z3k.js";import"./idempotency-C3fxGORY.js";const J="_page_1ly9g_1",Q="_pageHeader_1ly9g_7",V="_pageTitle_1ly9g_15",W="_pageActions_1ly9g_22",X="_tabs_1ly9g_28",Z="_tab_1ly9g_28",ee="_active_1ly9g_50",se="_tabContent_1ly9g_55",te="_section_1ly9g_63",ae="_sectionTitle_1ly9g_75",ie="_sectionContent_1ly9g_84",ne="_formGroup_1ly9g_90",oe="_formLabel_1ly9g_100",re="_required_1ly9g_106",le="_formInput_1ly9g_111",ce="_formSelect_1ly9g_115",de="_formCheckbox_1ly9g_125",me="_formCheckboxInput_1ly9g_132",ue="_formCheckboxLabel_1ly9g_138",_e="_formHelp_1ly9g_144",pe="_formActions_1ly9g_156",he="_userInfo_1ly9g_165",xe="_userAvatar_1ly9g_172",ve="_userDetails_1ly9g_185",ge="_userName_1ly9g_189",je="_userRole_1ly9g_196",fe="_userMeta_1ly9g_200",ye="_userMetaItem_1ly9g_205",Ne="_tokensList_1ly9g_213",ke="_tokenItem_1ly9g_219",Se="_tokenInfo_1ly9g_230",be="_tokenName_1ly9g_235",Ce="_tokenScopes_1ly9g_242",Ie="_tokenScope_1ly9g_242",Te="_tokenMeta_1ly9g_258",Le="_tokenActions_1ly9g_263",we="_auditList_1ly9g_269",De="_auditItem_1ly9g_275",Ae="_auditInfo_1ly9g_286",Me="_auditAction_1ly9g_291",$e="_auditDetails_1ly9g_298",Fe="_auditMeta_1ly9g_304",Pe="_auditTime_1ly9g_309",Re="_emptyState_1ly9g_315",Ue="_emptyStateIcon_1ly9g_321",Ee="_emptyStateTitle_1ly9g_327",He="_emptyStateDescription_1ly9g_334",Ge="_loadingState_1ly9g_339",qe="_loadingSpinner_1ly9g_344",s={page:J,pageHeader:Q,pageTitle:V,pageActions:W,tabs:X,tab:Z,active:ee,tabContent:se,section:te,sectionTitle:ae,sectionContent:ie,formGroup:ne,formLabel:oe,required:re,formInput:le,formSelect:ce,formCheckbox:de,formCheckboxInput:me,formCheckboxLabel:ue,formHelp:_e,formActions:pe,userInfo:he,userAvatar:xe,userDetails:ve,userName:ge,userRole:je,userMeta:fe,userMetaItem:ye,tokensList:Ne,tokenItem:ke,tokenInfo:Se,tokenName:be,tokenScopes:Ce,tokenScope:Ie,tokenMeta:Te,tokenActions:Le,auditList:we,auditItem:De,auditInfo:Ae,auditAction:Me,auditDetails:$e,auditMeta:Fe,auditTime:Pe,emptyState:Re,emptyStateIcon:Ue,emptyStateTitle:Ee,emptyStateDescription:He,loadingState:Ge,loadingSpinner:qe};function We(){const{id:_}=q(),b=B(),m=z(),u=O(),[i,C]=n.useState(null),[y,N]=n.useState([]),[I,$]=n.useState([]),[F,T]=n.useState(!0),[l,v]=n.useState("profile"),[g,k]=n.useState(!1),[L,w]=n.useState(!1),[j,p]=n.useState({role:"reader",email:"",is_active:!0}),[P,f]=n.useState(!1),[c,h]=n.useState({name:"",scopes:[],expires_at:""});n.useEffect(()=>{if(!_)return;(async()=>{try{T(!0);const[a,r,S]=await Promise.all([d.getUser(_),d.getUserTokens(_),d.getAuditLogs({actor_user_id:_,limit:10})]);C(a),N(r.tokens),$(S.logs),p({role:a.role,email:a.email||"",is_active:a.is_active})}catch(a){console.error("Failed to load user data:",a),m("Failed to load user data. Please try again.")}finally{T(!1)}})()},[_,m]);const R=async()=>{if(i)try{w(!0);const t=await d.updateUser(i.id,j);C(t),k(!1),u("User updated successfully")}catch(t){console.error("Failed to update user:",t),m("Failed to update user. Please try again.")}finally{w(!1)}},U=async()=>{if(i&&window.confirm(`Reset password for user ${i.login}?`))try{const t=await d.resetUserPassword(i.id,{});t.password?u(`Password reset successfully. New password: ${t.password}`):u("Password reset email sent successfully")}catch(t){console.error("Failed to reset password:",t),m("Failed to reset password. Please try again.")}},E=async()=>{if(i)try{const t=await d.createUserToken(i.id,{name:c.name,scopes:c.scopes,expires_at:c.expires_at||void 0});N(a=>[...a,t]),f(!1),h({name:"",scopes:[],expires_at:""}),t.token_plain_once?u(`Token created successfully: ${t.token_plain_once}`):u("Token created successfully")}catch(t){console.error("Failed to create token:",t),m("Failed to create token. Please try again.")}},H=async t=>{if(window.confirm("Are you sure you want to revoke this token?"))try{await d.revokeToken(t),N(a=>a.filter(r=>r.id!==t)),u("Token revoked successfully")}catch(a){console.error("Failed to revoke token:",a),m("Failed to revoke token. Please try again.")}};if(F)return e.jsx("div",{className:s.page,children:e.jsxs("div",{className:s.loadingState,children:[e.jsx("div",{className:s.loadingSpinner}),e.jsx("p",{children:"Loading user data..."})]})});if(!i)return e.jsx("div",{className:s.page,children:e.jsxs("div",{className:s.emptyState,children:[e.jsx("div",{className:s.emptyStateIcon,children:"ðŸ‘¤"}),e.jsx("div",{className:s.emptyStateTitle,children:"User not found"}),e.jsx("div",{className:s.emptyStateDescription,children:"The requested user could not be found."}),e.jsx(o,{onClick:()=>b("/admin/users"),children:"Back to Users"})]})});const G=t=>t.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2);return e.jsxs("div",{className:s.page,children:[e.jsxs("div",{className:s.pageHeader,children:[e.jsx("h1",{className:s.pageTitle,children:"User Details"}),e.jsxs("div",{className:s.pageActions,children:[e.jsx(o,{variant:"outline",onClick:()=>b("/admin/users"),children:"Back to Users"}),g?e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",onClick:()=>{k(!1),p({role:i.role,email:i.email||"",is_active:i.is_active})},children:"Cancel"}),e.jsx(o,{onClick:R,disabled:L,children:L?"Saving...":"Save Changes"})]}):e.jsx(o,{onClick:()=>k(!0),children:"Edit User"})]})]}),e.jsxs("div",{className:s.userInfo,children:[e.jsx("div",{className:s.userAvatar,children:G(i.login)}),e.jsxs("div",{className:s.userDetails,children:[e.jsx("h2",{className:s.userName,children:i.login}),e.jsx("div",{className:s.userRole,children:e.jsx(D,{role:i.role,size:"large"})}),e.jsxs("div",{className:s.userMeta,children:[e.jsxs("div",{className:s.userMetaItem,children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(A,{active:i.is_active})]}),e.jsxs("div",{className:s.userMetaItem,children:[e.jsx("strong",{children:"Email:"})," ",i.email||"Not provided"]}),e.jsxs("div",{className:s.userMetaItem,children:[e.jsx("strong",{children:"Created:"})," ",new Date(i.created_at).toLocaleDateString()]}),e.jsxs("div",{className:s.userMetaItem,children:[e.jsx("strong",{children:"Last Updated:"})," ",new Date(i.updated_at).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:s.tabs,children:[e.jsx("button",{className:`${s.tab} ${l==="profile"?s.active:""}`,onClick:()=>v("profile"),children:"Profile"}),e.jsx("button",{className:`${s.tab} ${l==="security"?s.active:""}`,onClick:()=>v("security"),children:"Security"}),e.jsxs("button",{className:`${s.tab} ${l==="tokens"?s.active:""}`,onClick:()=>v("tokens"),children:["Tokens (",y.length,")"]}),e.jsx("button",{className:`${s.tab} ${l==="audit"?s.active:""}`,onClick:()=>v("audit"),children:"Audit"})]}),e.jsx("div",{className:`${s.tabContent} ${l==="profile"?s.active:""}`,children:e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Profile Information"}),e.jsxs("div",{className:s.sectionContent,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Login"}),e.jsx(x,{value:i.login,disabled:!0,className:s.formInput}),e.jsx("div",{className:s.formHelp,children:"Username cannot be changed after creation."})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Email"}),g?e.jsx(x,{type:"email",value:j.email,onChange:t=>p(a=>({...a,email:t.target.value})),className:s.formInput}):e.jsx(x,{value:i.email||"Not provided",disabled:!0,className:s.formInput})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Role"}),g?e.jsxs(M,{value:j.role,onChange:t=>p(a=>({...a,role:t.target.value})),className:s.formSelect,children:[e.jsx("option",{value:"reader",children:"Reader"}),e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"admin",children:"Admin"})]}):e.jsx("div",{children:e.jsx(D,{role:i.role})})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Status"}),g?e.jsxs(M,{value:j.is_active?"active":"inactive",onChange:t=>p(a=>({...a,is_active:t.target.value==="active"})),className:s.formSelect,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}):e.jsx("div",{children:e.jsx(A,{active:i.is_active})})]})]})]})}),e.jsx("div",{className:`${s.tabContent} ${l==="security"?s.active:""}`,children:e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Security Settings"}),e.jsx("div",{className:s.sectionContent,children:e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Password Reset"}),e.jsx("div",{className:s.formHelp,children:"Reset the user's password. They will be required to change it on next login."}),e.jsx(o,{variant:"outline",onClick:U,children:"Reset Password"})]})})]})}),e.jsx("div",{className:`${s.tabContent} ${l==="tokens"?s.active:""}`,children:e.jsxs("div",{className:s.section,children:[e.jsxs("div",{className:s.sectionTitle,children:["Personal Access Tokens",e.jsx(o,{size:"small",onClick:()=>f(!0),style:{marginLeft:"var(--spacing-md)"},children:"Create Token"})]}),y.length===0?e.jsxs("div",{className:s.emptyState,children:[e.jsx("div",{className:s.emptyStateIcon,children:"ðŸ”‘"}),e.jsx("div",{className:s.emptyStateTitle,children:"No tokens"}),e.jsx("div",{className:s.emptyStateDescription,children:"This user has no personal access tokens."})]}):e.jsx("div",{className:s.tokensList,children:y.map(t=>e.jsxs("div",{className:s.tokenItem,children:[e.jsxs("div",{className:s.tokenInfo,children:[e.jsx("div",{className:s.tokenName,children:t.name}),e.jsx("div",{className:s.tokenScopes,children:t.scopes.map(a=>e.jsx("span",{className:s.tokenScope,children:a.scope},a.scope))}),e.jsxs("div",{className:s.tokenMeta,children:["Created: ",new Date(t.created_at).toLocaleDateString(),t.expires_at&&e.jsxs(e.Fragment,{children:[" â€¢ Expires: ",new Date(t.expires_at).toLocaleDateString()]}),t.last_used_at&&e.jsxs(e.Fragment,{children:[" â€¢ Last used: ",new Date(t.last_used_at).toLocaleDateString()]}),t.revoked_at&&e.jsxs(e.Fragment,{children:[" â€¢ Revoked: ",new Date(t.revoked_at).toLocaleDateString()]})]})]}),e.jsx("div",{className:s.tokenActions,children:!t.revoked_at&&e.jsx(o,{size:"small",variant:"danger",onClick:()=>H(t.id),children:"Revoke"})})]},t.id))})]})}),e.jsx("div",{className:`${s.tabContent} ${l==="audit"?s.active:""}`,children:e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Recent Activity"}),I.length===0?e.jsxs("div",{className:s.emptyState,children:[e.jsx("div",{className:s.emptyStateIcon,children:"ðŸ“‹"}),e.jsx("div",{className:s.emptyStateTitle,children:"No activity"}),e.jsx("div",{className:s.emptyStateDescription,children:"No recent activity found for this user."})]}):e.jsx("div",{className:s.auditList,children:I.map(t=>e.jsxs("div",{className:s.auditItem,children:[e.jsxs("div",{className:s.auditInfo,children:[e.jsx("div",{className:s.auditAction,children:t.action}),e.jsx("div",{className:s.auditDetails,children:t.object_type&&t.object_id&&e.jsxs(e.Fragment,{children:["Object: ",t.object_type," (",t.object_id,")"]})}),e.jsxs("div",{className:s.auditMeta,children:[t.ip&&e.jsxs(e.Fragment,{children:["IP: ",t.ip]}),t.user_agent&&e.jsxs(e.Fragment,{children:[" â€¢ ",t.user_agent]})]})]}),e.jsx("div",{className:s.auditTime,children:new Date(t.ts).toLocaleString()})]},t.id))})]})}),e.jsxs(Y,{open:P,onClose:()=>f(!1),title:"Create Personal Access Token",children:[e.jsxs("div",{className:s.sectionContent,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:`${s.formLabel} ${s.required}`,children:"Token Name"}),e.jsx(x,{value:c.name,onChange:t=>h(a=>({...a,name:t.target.value})),placeholder:"Enter token name",className:s.formInput})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:`${s.formLabel} ${s.required}`,children:"Scopes"}),e.jsx("div",{className:s.formHelp,children:"Select the permissions this token should have."}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid var(--color-border)",borderRadius:"var(--border-radius)",padding:"var(--spacing-sm)"},children:K.map(t=>e.jsxs("label",{className:s.formCheckbox,children:[e.jsx("input",{type:"checkbox",checked:c.scopes.includes(t.scope),onChange:a=>{a.target.checked?h(r=>({...r,scopes:[...r.scopes,t.scope]})):h(r=>({...r,scopes:r.scopes.filter(S=>S!==t.scope)}))},className:s.formCheckboxInput}),e.jsxs("span",{className:s.formCheckboxLabel,children:[e.jsx("strong",{children:t.scope})," - ",t.description]})]},t.scope))})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.formLabel,children:"Expires At"}),e.jsx(x,{type:"datetime-local",value:c.expires_at,onChange:t=>h(a=>({...a,expires_at:t.target.value})),className:s.formInput}),e.jsx("div",{className:s.formHelp,children:"Leave empty for no expiration."})]})]}),e.jsxs("div",{className:s.formActions,children:[e.jsx(o,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(o,{onClick:E,disabled:!c.name||c.scopes.length===0,children:"Create Token"})]})]})]})}export{We as UserDetailPage,We as default};
