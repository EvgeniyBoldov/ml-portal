import{c as B,r as s,j as t}from"./index-FkM6qUsl.js";import{a as H}from"./admin-DK_EKAlb.js";import{B as p}from"./Button-t5z5qQ-u.js";import{I as m}from"./Input-THmdJdCV.js";import{S as G}from"./Select-CqlyniY_.js";import{S as M}from"./Skeleton-3MZmQPtS.js";import"./idempotency-C3fxGORY.js";const w="_page_1tlak_1",F="_pageHeader_1tlak_7",E="_pageTitle_1tlak_15",$="_pageActions_1tlak_22",P="_filters_1tlak_28",U="_filterGroup_1tlak_39",R="_filterLabel_1tlak_46",O="_filterInput_1tlak_52",q="_filterSelect_1tlak_56",z="_filterActions_1tlak_60",J="_tableContainer_1tlak_67",K="_tableHeader_1tlak_74",Q="_tableTitle_1tlak_82",V="_tableStats_1tlak_89",W="_tableContent_1tlak_94",X="_auditItem_1tlak_98",Y="_auditInfo_1tlak_116",Z="_auditAction_1tlak_121",tt="_auditDetails_1tlak_128",et="_auditMeta_1tlak_134",at="_auditTime_1tlak_142",st="_auditActions_1tlak_149",it="_actionBadge_1tlak_155",nt="_create_1tlak_166",lt="_update_1tlak_171",ot="_login_1tlak_181",ct="_objectType_1tlak_191",rt="_objectId_1tlak_196",dt="_actorInfo_1tlak_202",_t="_actorAvatar_1tlak_208",ut="_actorName_1tlak_221",pt="_systemActor_1tlak_226",mt="_pagination_1tlak_231",ht="_paginationInfo_1tlak_240",jt="_paginationControls_1tlak_245",gt="_paginationButton_1tlak_251",ft="_active_1tlak_272",xt="_emptyState_1tlak_278",vt="_emptyStateIcon_1tlak_284",bt="_emptyStateTitle_1tlak_290",kt="_emptyStateDescription_1tlak_297",Nt="_loadingState_1tlak_302",St="_loadingSpinner_1tlak_307",yt="_spin_1tlak_1",e={page:w,pageHeader:F,pageTitle:E,pageActions:$,filters:P,filterGroup:U,filterLabel:R,filterInput:O,filterSelect:q,filterActions:z,tableContainer:J,tableHeader:K,tableTitle:Q,tableStats:V,tableContent:W,auditItem:X,auditInfo:Y,auditAction:Z,auditDetails:tt,auditMeta:et,auditTime:at,auditActions:st,actionBadge:it,create:nt,update:lt,delete:"_delete_1tlak_176",login:ot,default:"_default_1tlak_186",objectType:ct,objectId:rt,actorInfo:dt,actorAvatar:_t,actorName:ut,systemActor:pt,pagination:mt,paginationInfo:ht,paginationControls:jt,paginationButton:gt,active:ft,emptyState:xt,emptyStateIcon:vt,emptyStateTitle:bt,emptyStateDescription:kt,loadingState:Nt,loadingSpinner:St,spin:yt};function Ht(){const j=B(),[c,g]=s.useState([]),[l,f]=s.useState(!0),[x,k]=s.useState(0),[h,N]=s.useState(!1),[u,S]=s.useState(),[,v]=s.useState(),[i,b]=s.useState({actor_user_id:"",action:"",object_type:"",start_date:"",end_date:""}),n=s.useCallback(async(a,o=!1)=>{try{f(!0);const d={actor_user_id:i.actor_user_id||void 0,action:i.action||void 0,object_type:i.object_type||void 0,start_date:i.start_date||void 0,end_date:i.end_date||void 0,limit:50,cursor:a},_=await H.getAuditLogs(d);o?(g(_.logs),v(void 0)):g(D=>[...D,..._.logs]),k(_.total||0),N(_.has_more),S(_.next_cursor)}catch(d){console.error("Failed to load audit logs:",d),j("Failed to load audit logs. Please try again.")}finally{f(!1)}},[i,j]),y=s.useCallback(()=>{h&&u&&!l&&(v(u),n(u,!1))},[h,u,l,n]),A=s.useCallback(()=>{n(void 0,!0)},[n]),I=s.useCallback(()=>{n(void 0,!0)},[n]),r=a=>o=>{b(d=>({...d,[a]:o.target.value}))};s.useEffect(()=>{n(void 0,!0)},[n]);const C=a=>a.includes("create")||a.includes("created")?"create":a.includes("update")||a.includes("updated")?"update":a.includes("delete")||a.includes("deleted")?"delete":a.includes("login")||a.includes("auth")?"login":"default",T=a=>a?a.slice(0,2).toUpperCase():"S",L=a=>a.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");return t.jsxs("div",{className:e.page,children:[t.jsxs("div",{className:e.pageHeader,children:[t.jsx("h1",{className:e.pageTitle,children:"Audit Log"}),t.jsx("div",{className:e.pageActions,children:t.jsx(p,{onClick:A,variant:"outline",children:"Refresh"})})]}),t.jsxs("div",{className:e.filters,children:[t.jsxs("div",{className:e.filterGroup,children:[t.jsx("label",{className:e.filterLabel,children:"Actor"}),t.jsx(m,{placeholder:"User ID or login...",value:i.actor_user_id,onChange:r("actor_user_id"),className:e.filterInput})]}),t.jsxs("div",{className:e.filterGroup,children:[t.jsx("label",{className:e.filterLabel,children:"Action"}),t.jsx(m,{placeholder:"Action name...",value:i.action,onChange:r("action"),className:e.filterInput})]}),t.jsxs("div",{className:e.filterGroup,children:[t.jsx("label",{className:e.filterLabel,children:"Object Type"}),t.jsxs(G,{value:i.object_type,onChange:r("object_type"),className:e.filterSelect,children:[t.jsx("option",{value:"",children:"All Types"}),t.jsx("option",{value:"user",children:"User"}),t.jsx("option",{value:"token",children:"Token"}),t.jsx("option",{value:"password",children:"Password"}),t.jsx("option",{value:"auth",children:"Authentication"})]})]}),t.jsxs("div",{className:e.filterGroup,children:[t.jsx("label",{className:e.filterLabel,children:"Start Date"}),t.jsx(m,{type:"datetime-local",value:i.start_date,onChange:r("start_date"),className:e.filterInput})]}),t.jsxs("div",{className:e.filterGroup,children:[t.jsx("label",{className:e.filterLabel,children:"End Date"}),t.jsx(m,{type:"datetime-local",value:i.end_date,onChange:r("end_date"),className:e.filterInput})]}),t.jsxs("div",{className:e.filterActions,children:[t.jsx(p,{onClick:I,variant:"outline",children:"Search"}),t.jsx(p,{onClick:()=>{b({actor_user_id:"",action:"",object_type:"",start_date:"",end_date:""}),n(void 0,!0)},variant:"outline",children:"Clear"})]})]}),t.jsxs("div",{className:e.tableContainer,children:[t.jsxs("div",{className:e.tableHeader,children:[t.jsx("h2",{className:e.tableTitle,children:"Audit Logs"}),t.jsx("div",{className:e.tableStats,children:l?t.jsx(M,{width:100}):`Showing ${c.length} of ${x} logs`})]}),t.jsx("div",{className:e.tableContent,children:l&&c.length===0?t.jsxs("div",{className:e.loadingState,children:[t.jsx("div",{className:e.loadingSpinner}),t.jsx("p",{children:"Loading audit logs..."})]}):c.length===0?t.jsxs("div",{className:e.emptyState,children:[t.jsx("div",{className:e.emptyStateIcon,children:"ðŸ“‹"}),t.jsx("div",{className:e.emptyStateTitle,children:"No audit logs"}),t.jsx("div",{className:e.emptyStateDescription,children:"No audit logs found matching your criteria."})]}):t.jsx("div",{children:c.map(a=>t.jsxs("div",{className:e.auditItem,children:[t.jsxs("div",{className:e.auditInfo,children:[t.jsx("div",{className:e.auditAction,children:t.jsx("span",{className:`${e.actionBadge} ${e[C(a.action)]}`,children:L(a.action)})}),t.jsx("div",{className:e.auditDetails,children:a.object_type&&a.object_id&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:e.objectType,children:a.object_type}),t.jsxs("span",{className:e.objectId,children:[" ","(",a.object_id,")"]})]})}),t.jsxs("div",{className:e.auditMeta,children:[t.jsxs("div",{className:e.actorInfo,children:[t.jsx("div",{className:e.actorAvatar,children:T(a.actor_user_id)}),t.jsx("span",{className:a.actor_user_id?e.actorName:e.systemActor,children:a.actor_user_id?`User ${a.actor_user_id.slice(0,8)}`:"System"})]}),a.ip&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"â€¢"}),t.jsxs("span",{children:["IP: ",a.ip]})]}),a.user_agent&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"â€¢"}),t.jsx("span",{title:a.user_agent,children:a.user_agent.length>50?`${a.user_agent.slice(0,50)}...`:a.user_agent})]})]})]}),t.jsx("div",{className:e.auditTime,children:new Date(a.ts).toLocaleString()})]},a.id))})}),h&&t.jsxs("div",{className:e.pagination,children:[t.jsxs("div",{className:e.paginationInfo,children:["Showing ",c.length," of ",x," logs"]}),t.jsx("div",{className:e.paginationControls,children:t.jsx(p,{onClick:y,disabled:l,variant:"outline",children:l?"Loading...":"Load More"})})]})]})]})}export{Ht as AuditPage,Ht as default};
