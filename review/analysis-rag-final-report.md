# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç: –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ –∏ RAG

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### 1. **RAG —ç–Ω–¥–ø–æ–∏–Ω—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω**
```bash
curl -X POST http://localhost:80/api/v1/rag/upload/presign \
  -H "Content-Type: application/json" \
  -d '{"document_id": "test-doc-1", "content_type": "application/pdf"}'

# –û—Ç–≤–µ—Ç:
{
  "presigned_url": "http://minio:9000/rag/docs/test-doc-1?...",
  "bucket": "rag",
  "key": "docs/test-doc-1", 
  "content_type": "application/pdf",
  "expires_in": 3600
}
```

### 2. **–ê–Ω–∞–ª–∏–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**
```bash
curl -X POST "http://localhost:80/api/v1/analyze/ingest/presign?request=test" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{"document_id": "test-doc-1", "content_type": "application/pdf"}'

# –û—Ç–≤–µ—Ç: {"detail":"missing_tenant"}
```

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º:

### 1. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞**
- **–ü—Ä–æ–±–ª–µ–º–∞**: `AttributeError: 'int' object has no attribute 'total_seconds'` –≤ RAG
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `apps/api/src/app/adapters/s3_client.py` - –¥–æ–±–∞–≤–ª–µ–Ω `timedelta(seconds=options.expiry_seconds)`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å tenant_id**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ê–Ω–∞–ª–∏–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç —Ç—Ä–µ–±—É–µ—Ç `tenant_id`, –Ω–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `tenant_ids: []`
- **–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ tenant
- **–†–µ—à–µ–Ω–∏–µ**: –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å tenant –∏–ª–∏ –ø—Ä–∏–≤—è–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É tenant

### 3. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –±—ç–∫–µ–Ω–¥–∞**

#### **–ê–Ω–∞–ª–∏–∑**: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ–∂–∏–¥–∞–µ—Ç 6 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤, –±—ç–∫–µ–Ω–¥ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç 2
- ‚ùå `GET /analyze` - —Å–ø–∏—Å–æ–∫ –∞–Ω–∞–ª–∏–∑–æ–≤
- ‚ùå `POST /analyze/upload` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞  
- ‚ùå `GET /analyze/{id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞
- ‚ùå `GET /analyze/{id}/download` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
- ‚ùå `DELETE /analyze/{id}` - —É–¥–∞–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞
- ‚ùå `POST /analyze/{id}/reanalyze` - –ø–µ—Ä–µ–∞–Ω–∞–ª–∏–∑

#### **RAG**: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ–∂–∏–¥–∞–µ—Ç 12 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤, –±—ç–∫–µ–Ω–¥ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç 1
- ‚ùå `GET /rag/` - —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚ùå `POST /rag/upload` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
- ‚ùå `PUT /rag/{id}/tags` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–æ–≤
- ‚ùå `GET /rag/{id}/progress` - –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚ùå `GET /rag/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚ùå `GET /rag/metrics` - –º–µ—Ç—Ä–∏–∫–∏
- ‚ùå `GET /rag/{id}/download` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
- ‚ùå `POST /rag/{id}/archive` - –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚ùå `DELETE /rag/{id}` - —É–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- ‚ùå `POST /rag/search` - –ø–æ–∏—Å–∫
- ‚ùå `POST /rag/{id}/reindex` - –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
- ‚ùå `POST /rag/reindex` - –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤—Å–µ—Ö

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

### 1. **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)**:
- –î–æ–±–∞–≤–∏—Ç—å mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- –û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å tenant_id

### 2. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)**:
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤ –±—ç–∫–µ–Ω–¥–µ
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É tenant management
- –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é OpenAPI

## üéØ –°—Ç–∞—Ç—É—Å:
- ‚úÖ **RAG presign**: –†–∞–±–æ—Ç–∞–µ—Ç
- ‚ö†Ô∏è **–ê–Ω–∞–ª–∏–∑ presign**: –¢—Ä–µ–±—É–µ—Ç tenant_id
- ‚ùå **–û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**: –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã

**–í—ã–≤–æ–¥**: –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –Ω–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ –±—ç–∫–µ–Ω–¥ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
