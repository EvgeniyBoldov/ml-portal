# –û—Ç—á–µ—Ç –æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫—É–∫–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞:

### **422 –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–Ω–∞–Ω—Ç–∞**
**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–µ–¥–∞—á–µ–π —Ç–æ–∫–µ–Ω–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ –±—ç–∫–µ–Ω–¥–æ–º

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ HTTP-only –∫—É–∫–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

### **–ë—ç–∫–µ–Ω–¥ (API)**:

#### 1. **–û–±–Ω–æ–≤–ª–µ–Ω —Ä–æ—É—Ç–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** (`apps/api/src/app/api/v1/routers/security.py`):
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `Response` –∏ `get_settings`
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `login` —Ç–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç HTTP-only –∫—É–∫–∏:
  - `access_token` (15 –º–∏–Ω—É—Ç)
  - `refresh_token` (30 –¥–Ω–µ–π)
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `refresh` –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫—É–∫–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `logout` –æ—á–∏—â–∞–µ—Ç –∫—É–∫–∏

#### 2. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** (`apps/api/src/app/api/deps.py`):
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `get_current_user` —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –∏–∑:
  - Authorization header (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
  - HTTP-only –∫—É–∫–∏ (fallback)

### **–§—Ä–æ–Ω—Ç–µ–Ω–¥**:

#### 3. **–û–±–Ω–æ–≤–ª–µ–Ω API –∫–ª–∏–µ–Ω—Ç** (`apps/web/src/shared/lib/apiFetch.ts`):
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `credentials: 'include'` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫—É–∫–∏
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤

#### 4. **–û–±–Ω–æ–≤–ª–µ–Ω HTTP –∫–ª–∏–µ–Ω—Ç** (`apps/web/src/shared/api/http.ts`):
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `credentials: 'include'` –≤–æ –≤—Å–µ fetch –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `refreshAccessToken` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—É–∫–∏

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫—É–∫–∏:

### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
- ‚úÖ HTTP-only –∫—É–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è JavaScript (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)
- ‚úÖ SameSite=Lax –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º

### **–£–¥–æ–±—Å—Ç–≤–æ**:
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω–∞–º–∏ –≤ localStorage
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ñ–ª–æ—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**:
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ Authorization header, —Ç–∞–∫ –∏ –∫—É–∫–∏
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ API –∫–ª–∏–µ–Ω—Ç–∞–º–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤**:
- ‚úÖ **–õ–æ–≥–∏–Ω —Å –∫—É–∫–∏**: `POST /auth/login` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫—É–∫–∏
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–Ω–∞–Ω—Ç–∞**: `POST /tenants` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫—É–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: `POST /admin/users` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫—É–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ **–ö—É–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã**: `access_token` –∏ `refresh_token` –≤ HTTP-only –∫—É–∫–∏

### **–ü—Ä–∏–º–µ—Ä—ã –∫—É–∫–∏**:
```
#HttpOnly_localhost	FALSE	/	FALSE	1759694856	access_token	eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
#HttpOnly_localhost	FALSE	/	FALSE	1762285956	refresh_token	eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—É–∫–∏:

```python
# –ë—ç–∫–µ–Ω–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
response.set_cookie(
    key="access_token",
    value=access_token,
    max_age=settings.JWT_ACCESS_TTL_MINUTES * 60,  # 15 –º–∏–Ω—É—Ç
    httponly=True,      # –ó–∞—â–∏—Ç–∞ –æ—Ç XSS
    secure=False,       # True –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Å HTTPS
    samesite="lax"      # –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF
)
```

```typescript
// –§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
fetch(url, { 
  ...opts, 
  headers,
  credentials: 'include' // –í–∫–ª—é—á–∏—Ç—å –∫—É–∫–∏
});
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç:
- **422 –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã** - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –∫—É–∫–∏
- **–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ñ–ª–æ—É** - –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω–∞–º–∏
- **–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - HTTP-only –∫—É–∫–∏ –∑–∞—â–∏—â–∞—é—Ç –æ—Ç XSS
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

–¢–µ–ø–µ—Ä—å –∞–¥–º–∏–Ω—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –ø—Ä–æ–±–ª–µ–º! üöÄ
